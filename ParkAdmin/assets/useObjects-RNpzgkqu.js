import{_ as z,e as n,i as w,c as h,o as v,a as d,n as W,k as E,z as A,E as q,F as T,j as I,D as Z,t as L,m as J,f as K,p as Q,G as X,s as Y,b as $,g as B,w as O,H as ee,x as C,y as te}from"./index-CHysKgRS.js";import{i as ae,f as le,j as oe,F as R,_ as P,a as se,u as ne}from"./FilterSortDate-C6tpu_jT.js";import{c as _,o as V}from"./modal-DRTCzFhK.js";const re=["innerHTML"],ie={class:"form-field"},ce=["name"],ue={key:0,class:"dropdown-list"},de=["onMousedown"],me={__name:"FormField",props:{modelValue:{type:[String,Number,null],default:""},label:{type:String},labelWidth:{type:Number,default:75},name:{type:String,required:!0},items:{type:Array,default:()=>[]}},emits:["update:modelValue","select"],setup(l,{emit:a}){const s=l,o=a,e=n(!1),t=n(s.modelValue),i=n(!1),f=w(()=>s.items.filter(m=>m.toLowerCase().includes(t.value.toLowerCase()))),c=m=>{o("update:modelValue",t.value),y(),u()},r=m=>{t.value=m,g(),o("update:modelValue",t.value),o("select",m),u()},u=()=>{t.value.length<1?e.value=!0:e.value=!1},y=()=>{i.value=!0},g=()=>{i.value=!1};return(m,S)=>(v(),h("div",{class:J(["field-outer",{"has-error":e.value==!0}])},[d("label",{innerHTML:l.label,style:W({width:l.labelWidth+"px"})},null,12,re),d("div",ie,[E(d("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=b=>t.value=b),onInput:c,onFocusin:y,onFocusout:g,name:l.name},null,40,ce),[[q,t.value]]),i.value==!0&&f.value.length>0?(v(),h("ul",ue,[(v(!0),h(T,null,I(f.value,b=>(v(),h("li",{key:b,onMousedown:Z(F=>r(b),["prevent"]),class:"dropdown-item"},L(b),41,de))),128))])):A("",!0)])],2))}},Ee=z(me,[["__scopeId","data-v-5834f11e"]]),Te={__name:"SecondaryTable",props:{data:{type:Array,default:()=>[]},columns:{type:Array,required:!0},options:{type:Object,default:()=>({})}},setup(l,{expose:a}){const s=l,o=n(null);let e=null;return K(()=>{e=new ae(o.value,{layout:"fitColumns",rowHeight:55,data:s.data,columns:s.columns,...s.options})}),Q(()=>{e&&e.destroy()}),X(()=>s.data,t=>{e?.replaceData(t)}),a({getTable:()=>e}),(t,i)=>(v(),h("div",{ref_key:"tableRef",ref:o,class:"secondary-table"},null,512))}},M=Y("objects",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"name",title:"Название",headerSort:!1,width:140},{field:"geopos",title:"Геопозиция",headerSort:!1,width:150},{field:"country",title:"Страна",headerSort:!1,width:100},{field:"city",title:"Город",headerSort:!1,width:100},{field:"address",title:"Адрес",headerSort:!1,width:200},{field:"acquiring",title:"Эквайринг",headerSort:!1,width:200},{field:"status",title:"Статус",headerSort:!1,width:160},{field:"commission",title:"Комиссия",headerSort:!1},{field:"lang",title:"Язык",headerSort:!1},{field:"currency",title:"Валюта",headerSort:!1},{field:"pp",title:"%PP",headerSort:!1,width:75}],content:[{id:1,name:"ТЦ Ромашка",geopos:"Россия",country:"Россия",city:"Пенза",address:"Светлая, 13",acquiring:"Точка Банк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:10,total_sum:1e4,average_length:670,average_sum:340},{id:2,name:"ТЦ Метрополис",geopos:"Россия",country:"Россия",city:"Москва",address:"Большая Полянка, 31",acquiring:"Сбербанк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:15,total_sum:7e3,average_length:265,average_sum:775},{id:3,name:"ТЦ Таганка",geopos:"Россия",country:"Россия",city:"Пенза",address:"Светлая, 13",acquiring:"Точка Банк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:10,total_sum:11e3,average_length:560,average_sum:900},{id:4,name:"ТЦ Лорисы",geopos:"Россия",country:"Россия",city:"Пенза",address:"Светлая, 13",acquiring:"Точка Банк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:10,total_sum:8e3,average_length:654,average_sum:340},{id:5,name:"ТЦ Долиной",geopos:"Россия",country:"Россия",city:"Москва",address:"Большая Полянка, 31",acquiring:"Сбербанк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:15,total_sum:1e4,average_length:344,average_sum:775},{id:6,name:"ТЦ Хата",geopos:"Россия",country:"Россия",city:"Пенза",address:"Светлая, 13",acquiring:"Точка Банк",status:"Действующий",commission:"Включена",lang:"RU",currency:"Рубль",pp:10,total_sum:1e4,average_length:455,average_sum:900}]},modalTable:{tabs:[{name:"data",label:"Данные о компании"},{name:"contact",label:"Контактные лица"}],fields:{clients:["ООО Ромашка","ООО Название","ООО НеНазвание","ООО Крутое","ООО ЪЫБа"],client:"ООО “Сириус”",object:"ТЦ Ромашка",status:"Активен",statusOptions:[{label:"Активен",value:"Активен"},{label:"Отключен",value:"Отключен"}],domain:"my-company.com",fiscalServices:[{label:"Атол онлайн",value:"Атол онлайн"},{label:"AFАтол оffлайн",value:"AFАтол оffлайн"}],fiscalService:"Атол онлайн",checkEmail:"promkrep@yandex.ru",countries:[{label:"Россия",value:"Россия"},{label:"Туркменистан",value:"Туркменистан"}],country:"Россия",address:"Москва, ул. Ленина,1",timeZones:[{label:"(GMT+3) Москва",value:"(GMT+3) Москва"},{label:"(GMT+5) Ашхабад",value:"(GMT+5) Ашхабад"}],timeZone:"(GMT+3) Москва",currencies:[{label:"Руб",value:"rub"},{label:"Доллар США",value:"usd"}],currency:"rub",langs:[{label:"Ru",value:"ru"},{label:"EN",value:"en"}],lang:"ru"},columns:[{field:"name",title:"ФИО",width:121,headerSort:!1,editor:"input"},{field:"position",title:"Должность",width:98,headerSort:!1,editor:"input"},{field:"phone",title:"Телефон",headerSort:!1,editor:"input",editorParams:{mask:"+*****************",selectContents:!0,maskAutoFill:!0}},{field:"email",title:"E-mail",headerSort:!1,editor:"input"},{title:"",field:"actions",hozAlign:"center",headerSort:!1,width:30,formatter:function(){return`
                  <div class="table-action">
                    <img src="${le}" class="delete-btn" />
                  </div>
              `},cellClick:function(l,a){const s=a.getRow();l.target.classList.contains("delete-btn")&&s.delete()}}],content:[{name:"Петров Виктор Сидорович",position:"Ген.директор",phone:"+7 (495) 123-45-67",email:"petrov.vs@centercity.ru"},{name:"Сидорова Анна Михайловна",position:"Главный инженер",phone:"+7 (916) 100-20-30",email:"sidorova.am@city.ru"},{name:"Ковалев Игорь Дмитриевич",position:"Менеджер парковки",phone:"+7 (495) 123-45-67",email:"kovalev.id@centercity.ru"}]},massEditor:{params:[{label:"Геопозиция",value:"geopos"},{label:"Страна",value:"country"},{label:"Город",value:"city"},{label:"Адрес",value:"address"},{label:"Эквайринг",value:"acquiring"},{label:"Статус",value:"status"},{label:"Комиссия",value:"commission"},{label:"Язык",value:"lang"},{label:"Валюта",value:"currency"},{label:"%PP",value:"pp"}]}})}),pe={class:"custom-filter search-filter"},fe={class:"filter-row"},ve={class:"custom-filter dropdown-filter"},be=["value"],he={class:"checkbox-label"},ye={__name:"FilterSortSearch",props:{dropdownItems:{type:Array,default:()=>[]},onSelectSortOrder:Function,onSelectCheckbox:Function},setup(l){const a=l,s=n(""),o=n(!0),e=n([]),t=w(()=>a.dropdownItems.filter(c=>c.name.toLowerCase().includes(s.value.toLowerCase()))),i=c=>{a.onSelectSortOrder(c)},f=()=>{a.onSelectCheckbox(e.value)};return(c,r)=>(v(),h(T,null,[$(R,null,{default:O(()=>[$(oe,{"on-select-sort-order":i}),r[4]||(r[4]=d("hr",null,null,-1)),d("div",pe,[d("div",fe,[r[3]||(r[3]=d("span",{class:"label"},"Фильтр",-1)),d("button",{class:"reset-filter",onClick:r[0]||(r[0]=u=>c.$emit("reset-filter"))},"(сбросить фильтр)")]),E(d("input",{type:"text",class:"search-field",name:"search-filter",placeholder:"Поиск...","onUpdate:modelValue":r[1]||(r[1]=u=>s.value=u),autocomplete:"off"},null,512),[[q,s.value]])])]),_:1}),o.value==!0?(v(),B(R,{key:0},{default:O(()=>[d("div",ve,[(v(!0),h(T,null,I(t.value,u=>(v(),h("label",{class:"checkbox",key:u},[E(d("input",{type:"checkbox",value:u.name,"onUpdate:modelValue":r[2]||(r[2]=y=>e.value=y),onChange:f},null,40,be),[[ee,e.value]]),d("span",he,L(u.name),1)]))),128))])]),_:1})):A("",!0)],64))}};function ge(){return{applyFiltersToColumns:(a,s,o)=>s.map(e=>e.field==="name"?{...e,headerClickPopup(){const t=document.createElement("div");return C(P,{onSelectSortOrder(){o(a,"name")}}).mount(t),t}}:e.field==="geopos"?{...e,headerClickPopup(){const t=document.createElement("div");return C(P,{onSelectSortOrder(){o(a,"geopos")}}).mount(t),t}}:e.field==="country"?{...e,headerClickPopup(){const t=document.createElement("div");return C(se,{onSelectSortOrder(){o(a,"country")},onSelectCompareState(){o(a,"country")},onSelectDate(){o(a,"country")},onSelectDateRange(){o(a,"country")}}).mount(t),t}}:e.field==="city"?{...e,headerClickPopup(){const t=document.createElement("div");return C(ye,{onSelectSortOrder(){o(a,"city")},dropdownItems:[{name:"Пенза"},{name:"Мосва"},{name:"Самара"},{name:"Екатеринбург"},{name:"Кемерово"}],onSelectCheckbox(){o(a,"city")}}).mount(t),t}}:e)}}function Se(){const l=M(),a=n(null),s=n(null),o=n(null),e=n(null),t=n(null),i=n(l.modalTable.tabs),f=w(()=>l.modalTable.fields),c=l.modalTable.columns,r=l.modalTable.content,u=n(!1);return l.$subscribe((S,b)=>{u.value=!0}),{objectEditorRef:a,contactsTableRef:s,savePopupRef:o,saveNotifyRef:e,deleteSinglePopupRef:t,objectEditorTabs:i,objectEditorFields:f,objectEditorTableColumns:c,objectEditorTableContent:r,objectHasEdited:u,saveConfirmClick:()=>{_(o.value),V(e.value),setTimeout(()=>_(e.value),3e3)},cancelSaveClick:()=>{_(o.value),_(a.value)},addModalTableRow:()=>{s.value.getTable()?.addRow({id:Date.now(),name:"",status:"new"}),l.modalTable.content.push({id:Date.now(),name:"",status:"new"})}}}function _e(l){const a=M(),s=n(null),o=n([{name:"edit",label:"Массовое редактирование"}]),e=n(a.massEditor.params),t=te([{}]);return{massEditorRef:s,massEditorTabs:o,massEditorParams:e,massEditorFields:t,openMassEditor:()=>l.openMassEditor(s),addMassEditorFieldsRow:()=>l.addMassEditorFieldsRow(t)}}function Me(){const l=M(),a=ne(),{hasSelection:s,selectedCount:o,selectedRows:e,selectedRowsName:t,changeTableSettings:i,addResetFilterBtn:f}=a,c=n(null),r=w(()=>l.mainTable.columns),u=w(()=>l.mainTable.content),y=n(null),g=r.value.filter(p=>p.formatter!=="rowSelection").map(p=>({field:p.field,title:p.title})),m=n(null),S=n([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:b}=ge();l.mainTable.columns=b(c,r.value,f);const F=Se(),U=_e(a),j=n([]),k=n(!1),D=()=>a.deselectAll(c),N=()=>a.deleteSelected(c,()=>_(m.value)),H=()=>V(m.value),G=p=>{a.onSelectionChanged(p,"name"),k.value&&x()},x=()=>{k.value=!0,j.value=e.value.map(p=>({name:p.name,average_length:p.average_length,average_sum:p.average_sum,total_sum:p.total_sum}))};return{objectsStore:l,mainTableRef:c,tableHeader:r,tableContent:u,tableSettingsHeader:g,hasSelection:s,selectedCount:o,selectedRows:e,selectedRowsName:t,deleteSelectedPopupRef:m,tableSettingsRef:y,statusOptionsList:S,showCalculatedSummary:k,summaryItems:j,...F,...U,onSelectionChanged:G,deselectAll:D,deleteSelected:N,changeTableSettings:i,calculateSummaryItems:x,openDeletePopup:H}}export{Ee as F,Te as _,ye as a,M as b,Me as u};
