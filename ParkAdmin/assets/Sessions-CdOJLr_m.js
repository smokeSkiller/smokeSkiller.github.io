import{_ as U,a as K,u as ee,T as te,P as se,b as le,B as ne,c as oe,d as ae,e as ie,f as re,g as W,h as ue,D as de,i as me,j as ce,k as pe,F as h,l as fe}from"./FilterSortDate-DwA6o7ns.js";import{C as be,_ as ve}from"./CalculatedSummary-DAMxnVYl.js";import{_ as N,a as q}from"./note-icon-CfdApiIo.js";import{o as B,c as A}from"./modal-DRTCzFhK.js";import{s as Se,x as V,e as b,y as ge,i as G,_ as we,c as _,a as e,b as u,w as c,g as J,z as Q,u as s,A as Ce,F as X,o as $,d,B as ke,t as Y,n as xe,j as ye}from"./index-Ye-EomIF.js";import{B as M}from"./BaseButton-BJgVlfLN.js";const Z=Se("sessions",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"object-name",title:"Объект",headerSort:!1,width:140},{field:"vehicle-number",title:"Номер ТС",headerSort:!1,width:150},{field:"enter-time",title:"Время въезда",headerSort:!1},{field:"exit-time",title:"Время выезда",headerSort:!1},{field:"duration",title:"Длительность",headerSort:!1,width:135,formatter:function(r){const l=Number(r.getValue());if(!l||isNaN(l))return"—";const p=Math.floor(l/3600),a=Math.floor(l%3600/60),i=l%60,n=f=>f.toString().padStart(2,"0");return`${n(p)}:${n(a)}:${n(i)}`}},{field:"total",title:"Сумма",headerSort:!1,width:200,formatter:function(r){return`${r.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(r){const l=r.getValue();return{paid:'<span class="status status-paid">Оплачена</span>',active:'<span class="status status-active">Активна</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[l]??l}}],content:[{id:1,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:5400,status:"paid",total:450},{id:2,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1e3,status:"active",total:600},{id:3,"object-name":"ТЦ Мега","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:1200,status:"canceled",total:500},{id:4,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:2400,status:"paid",total:450},{id:5,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1500,status:"active",total:400}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function Ee(){return{applyFiltersToColumns:(l,p,a)=>p.map(i=>i.field==="id"?{...i,headerClickPopup(){const n=document.createElement("div");return V(U,{onSelectSortOrder(){a(l,"id")}}).mount(n),n}}:i.field==="object-name"?{...i,headerClickPopup(){const n=document.createElement("div");return V(U,{onSelectSortOrder(){a(l,"object-name")}}).mount(n),n}}:i.field==="enter-time"?{...i,headerClickPopup(){const n=document.createElement("div");return V(K,{onSelectSortOrder(){a(l,"enter-time")},onSelectCompareState(){a(l,"enter-time")},onSelectDate(){a(l,"enter-time")},onSelectDateRange(){a(l,"enter-time")}}).mount(n),n}}:i.field==="exit-time"?{...i,headerClickPopup(){const n=document.createElement("div");return V(K,{onSelectSortOrder(){a(l,"exit-time")},onSelectCompareState(){a(l,"exit-time")},onSelectDate(){a(l,"exit-time")},onSelectDateRange(){a(l,"exit-time")}}).mount(n),n}}:i)}}function $e(r){const l=Z(),p=b(null),a=b([{name:"edit",label:"Массовое редактирование"}]),i=b(l.massEditor.params),n=ge([{}]);return{massEditorRef:p,massEditorTabs:a,massEditorParams:i,massEditorFields:n,openMassEditor:()=>r.openMassEditor(p),addMassEditorFieldsRow:()=>r.addMassEditorFieldsRow(n)}}function Me(){const r=Z(),l=ee(),{hasSelection:p,selectedCount:a,selectedRows:i,selectedRowsName:n,changeTableSettings:f,addResetFilterBtn:j}=l,v=b(null),S=G(()=>r.mainTable.columns),D=G(()=>r.mainTable.content),P=b(null),I=b(null),g=S.value.filter(m=>m.formatter!=="rowSelection").map(m=>({field:m.field,title:m.title})),w=b(null),T=b([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:L}=Ee();r.mainTable.columns=L(v,S.value,j);const C=$e(l),k=b([]),x=b(!1),y=()=>l.deselectAll(v),F=()=>l.deleteSelected(v,()=>A(w.value)),O=()=>B(w.value),R=m=>{l.onSelectionChanged(m,"id"),x.value&&E()},E=()=>{x.value=!0,k.value=i.value.map(m=>({name:m["object-name"],average_length:m.duration,average_sum:m.total,total_sum:m.total}))};return{sessionsStore:r,mainTableRef:v,tableHeader:S,tableContent:D,tableSettingsHeader:g,sessionDetailsRef:P,hasSelection:p,selectedCount:a,selectedRows:i,selectedRowsName:n,deleteSelectedPopupRef:w,tableSettingsRef:I,statusOptionsList:T,showCalculatedSummary:x,summaryItems:k,...C,onSelectionChanged:R,deselectAll:y,deleteSelected:F,changeTableSettings:f,calculateSummaryItems:E,openDeletePopup:O}}const je="/ParkAdmin/assets/session-CFWKBI7c.png",De={class:"page"},Pe={class:"page-content"},Te={class:"content-inner"},Fe={class:"top-box"},Re={class:"popup-title"},Ne={action:"#"},Ve=["onClick"],Ae={__name:"Sessions",setup(r){const{sessionsStore:l,mainTableRef:p,tableHeader:a,tableContent:i,tableSettingsHeader:n,sessionDetailsRef:f,hasSelection:j,selectedCount:v,selectedRowsName:S,deleteSelectedPopupRef:D,tableSettingsRef:P,statusOptionsList:I,showCalculatedSummary:g,summaryItems:w,massEditorRef:T,massEditorTabs:L,massEditorParams:C,massEditorFields:k,onSelectionChanged:x,deselectAll:y,openDeletePopup:F,deleteSelected:O,openMassEditor:R,addMassEditorFieldsRow:E,changeTableSettings:m,calculateSummaryItems:H}=Me();return(Ie,t)=>($(),_(X,null,[e("main",De,[u(te,null,{default:c(()=>[u(M,{class:"btn-filled"},{default:c(()=>[...t[15]||(t[15]=[d("Сессии",-1)])]),_:1}),u(M,{onClick:t[0]||(t[0]=o=>s(ke).push("/payments"))},{default:c(()=>[...t[16]||(t[16]=[d("Оплаты",-1)])]),_:1})]),_:1}),e("div",Pe,[s(g)?Q("",!0):($(),J(se,{key:0},Ce({right:c(()=>[u(M,{class:"small-btn",onClick:t[6]||(t[6]=o=>s(B)(s(P)))},{default:c(()=>[...t[22]||(t[22]=[e("img",{src:ce},null,-1)])]),_:1}),u(M,{class:"small-btn"},{default:c(()=>[...t[23]||(t[23]=[e("img",{src:pe},null,-1)])]),_:1})]),_:2},[s(j)==!0?{name:"left",fn:c(()=>[e("div",{class:"selected-count controller-item",onClick:t[1]||(t[1]=(...o)=>s(y)&&s(y)(...o))},[e("span",null,"Выбрано: "+Y(s(v)),1),u(M,{class:"btn-filled"},{default:c(()=>[...t[17]||(t[17]=[e("img",{src:re},null,-1)])]),_:1})]),e("div",{class:"delete-row controller-item",onClick:t[2]||(t[2]=(...o)=>s(F)&&s(F)(...o))},[...t[18]||(t[18]=[e("img",{src:W},null,-1),d(" Удалить ",-1)])]),e("div",{class:"edit controller-item",onClick:t[3]||(t[3]=(...o)=>s(R)&&s(R)(...o))},[...t[19]||(t[19]=[e("img",{src:ue},null,-1),d(" Редактировать ",-1)])]),u(de,{class:"change-status controller-item","dropdown-list":s(I),onChange:t[4]||(t[4]=o=>console.log("Status changed to: ",o))},{default:c(()=>[...t[20]||(t[20]=[e("img",{src:me},null,-1),d(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"]),e("div",{class:"summary controller-item",onClick:t[5]||(t[5]=(...o)=>s(H)&&s(H)(...o))},[...t[21]||(t[21]=[e("img",{src:ve},null,-1),d(" Сумма ",-1)])])]),key:"0"}:void 0]),1024)),s(g)?($(),J(be,{key:1,"selected-text":`${s(v)} объектов`,items:s(w),onReset:t[7]||(t[7]=o=>(g.value=!1,s(y)()))},null,8,["selected-text","items"])):Q("",!0),u(le,{style:{"margin-top":"20px"},columns:s(a),data:s(i),onRowDblclick:t[8]||(t[8]=o=>s(B)(s(f))),onSelectionChanged:s(x),ref_key:"mainTableRef",ref:p},null,8,["columns","data","onSelectionChanged"])])]),u(ne,{"inner-width":"515","custom-class":"session-details",ref_key:"sessionDetailsRef",ref:f},{header:c(()=>[t[25]||(t[25]=e("h2",{class:"title"},"Сессия №1665423547316996",-1)),e("button",{class:"close-btn",onClick:t[9]||(t[9]=o=>s(A)(s(f)))},[...t[24]||(t[24]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:c(()=>[e("div",Te,[e("div",Fe,[e("div",{class:"img",style:xe({"background-image":`url(${s(je)})`})},null,4),t[26]||(t[26]=e("div",{class:"content"},[e("p",null,[d(" Номер ТС: "),e("b",null,"М969ММ777")]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[d("Объект: "),e("b",null,"ТЦ “Мега”")]),e("button",{class:"icon link-icon"},[e("img",{src:N})])]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[d("Клиент: "),e("b",null,"ООО Ирбис")]),e("button",{class:"icon link-icon"},[e("img",{src:N})])]),e("p",null,[d("Статус: "),e("b",null,"Оплачена")]),e("p",null,[d("Продолжительность: "),e("b",null,"02:44:26")])],-1))]),t[27]||(t[27]=e("div",{class:"box"},[e("h4",null,"Въезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1)),t[28]||(t[28]=e("div",{class:"box"},[e("h4",null,"Оплата:"),e("div",{class:"row"},[e("p",null,"04.11.2025, 15:50:31, Банковская карта ****1234"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"450 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:q})]),e("button",{class:"icon link-icon"},[e("img",{src:N})])])]),e("div",{class:"row row-error"},[e("p",null,"04.11.2025, 15:54:17, Банковская карта ****5990"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"450 ₽, ошибка оплаты")])])]),e("div",{class:"row"},[e("p",null,"04.11.2025, 16:03:14, Касса №2009"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"450 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:q})]),e("button",{class:"icon link-icon"},[e("img",{src:N})])])])],-1)),t[29]||(t[29]=e("div",{class:"box"},[e("h4",null,"Выезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1))])]),_:1},512),u(oe,{ref_key:"deleteSelectedPopupRef",ref:D,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:s(O),onCancel:t[10]||(t[10]=o=>s(A)(s(D)))},{default:c(()=>[e("h2",Re,[t[30]||(t[30]=d(" Удалить сессии? ",-1)),t[31]||(t[31]=e("br",null,null,-1)),d(" "+Y(s(S)),1)])]),_:1},8,["onConfirm"]),u(ae,{tabs:s(L),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:t[12]||(t[12]=o=>console.log("Changes saved!")),onCloseClick:t[13]||(t[13]=o=>s(A)(s(T))),ref_key:"massEditorRef",ref:T},{edit:c(()=>[e("form",Ne,[t[34]||(t[34]=e("h3",null,"Редактирование выбранных объектов",-1)),t[35]||(t[35]=e("div",{class:"d-flex"},[e("span",{class:"fields-label"},"Параметр"),e("span",{class:"fields-label"},"До изменения"),e("span",{class:"fields-label"},"После изменения")],-1)),($(!0),_(X,null,ye(s(k),(o,z)=>($(),_("div",{class:"fields-row",key:z},[u(h,{options:s(C)},null,8,["options"]),u(h,{options:s(C)},null,8,["options"]),u(h,{options:s(C)},null,8,["options"]),e("button",{type:"button",class:"delete-row",onClick:Le=>s(k).splice(z,1)},[...t[32]||(t[32]=[e("img",{src:W},null,-1)])],8,Ve)]))),128)),e("button",{type:"button",class:"add-fields-btn",onClick:t[11]||(t[11]=(...o)=>s(E)&&s(E)(...o))},[...t[33]||(t[33]=[e("img",{src:fe},null,-1),d(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),u(ie,{"table-columns":s(n),onChange:t[14]||(t[14]=o=>s(m)(o,s(l),s(p))),ref_key:"tableSettingsRef",ref:P},null,8,["table-columns"])],64))}},Ue=we(Ae,[["__scopeId","data-v-0781441a"]]);export{Ue as default};
