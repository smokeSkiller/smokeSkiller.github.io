import{_,a as h,u as ee,T as te,P as le,b as se,c as q,d as ne,e as oe,B as ae,f as ie,g as G,h as re,D as de,i as ue,j as pe,k as me,F as j,l as ce,m as fe,O as be}from"./FilterSortDate-BqPtcMbh.js";import{a as X,_ as I}from"./note-icon-CfdApiIo.js";import{o as $,c as D}from"./modal-DRTCzFhK.js";import{s as ve,x as J,e as m,y as ye,i as K,_ as ge,c as N,a as e,b as o,w as i,A as Se,u as l,F as Q,o as H,B as ke,d as f,t as W,j as we,C as Ce}from"./index-DGabDp82.js";import{B as g}from"./BaseButton-C9cgcOly.js";const Y=ve("payments",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"sum",title:"Сумма",headerSort:!1,width:150,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"payment-time",title:"Время оплаты",headerSort:!1,width:145},{field:"payment-type",title:"Тип оплаты",headerSort:!1,width:145},{field:"check",title:"Чек",headerSort:!1,width:200,formatter:function(a){return`
                            <div class="check-cell">
                                <span>${a.getValue()}</span>
                                <button class="check-btn">
                                    <img src="${X}" />
                                </button>
                            </div>
                        `},cellClick:(a,n)=>{if(a.target.closest(".check-btn")){const r=n.getValue();console.log("Нажали на кнопку чека:",r)}}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(a){const n=a.getValue();return{paid:'<span class="status status-paid">Успешно</span>',refunded:'<span class="status status-canceled">Возвращён</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}}],content:[{sum:450,id:1,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:6e4,id:2,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"canceled"},{sum:1200,id:3,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"},{sum:700,id:4,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:23e3,id:5,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"paid"},{sum:2100,id:6,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function Pe(){return{applyFiltersToColumns:(n,r,u)=>r.map(p=>p.field==="id"?{...p,headerClickPopup(){const d=document.createElement("div");return J(_,{onSelectSortOrder(){u(n,"id")}}).mount(d),d}}:p.field==="payment-time"?{...p,headerClickPopup(){const d=document.createElement("div");return J(h,{onSelectSortOrder(){u(n,"payment-time")},onSelectCompareState(){u(n,"payment-time")},onSelectDate(){u(n,"payment-time")},onSelectDateRange(){u(n,"payment-time")}}).mount(d),d}}:p)}}function xe(a){const n=Y(),r=m(null),u=m([{name:"edit",label:"Массовое редактирование"}]),p=m(n.massEditor.params),d=ye([{}]);return{massEditorRef:r,massEditorTabs:u,massEditorParams:p,massEditorFields:d,openMassEditor:()=>a.openMassEditor(r),addMassEditorFieldsRow:()=>a.addMassEditorFieldsRow(d)}}function Ee(){const a=Y(),n=ee(),{hasSelection:r,selectedCount:u,selectedRows:p,selectedRowsName:d,changeTableSettings:b,addResetFilterBtn:x}=n,v=m(null),y=K(()=>a.mainTable.columns),E=K(()=>a.mainTable.content),F=m(null),M=y.value.filter(c=>c.formatter!=="rowSelection").map(c=>({field:c.field,title:c.title})),S=m(null),k=m([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:R}=Pe();a.mainTable.columns=R(v,y.value,x);const w=xe(n),C=m(null),P=m(null),V=m(""),T=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],O=m(!0);return{paymentsStore:a,mainTableRef:v,tableHeader:y,tableContent:E,tableSettingsHeader:M,hasSelection:r,selectedCount:u,selectedRows:p,selectedRowsName:d,deleteSelectedPopupRef:S,tableSettingsRef:F,statusOptionsList:k,paymentDetailsRef:C,refundPopupRef:P,refundType:V,refundTypeOptions:T,refundConfirmDisabled:O,...w,onSelectionChanged:c=>{n.onSelectionChanged(c,"id"),showCalculatedSummary.value&&calculateSummaryItems()},deselectAll:()=>n.deselectAll(v),deleteSelected:()=>n.deleteSelected(v,()=>D(S.value)),changeTableSettings:b,openDeletePopup:()=>$(S.value)}}const Re={class:"page"},Te={class:"page-content"},$e={class:"popup-title"},De={action:"#"},Fe=["onClick"],Me={class:"content-inner"},Ve={class:"w-100",style:{margin:"20px 0"}},Oe={class:"row refund-select"},Ae={__name:"Payments",setup(a){const{paymentsStore:n,mainTableRef:r,tableHeader:u,tableContent:p,tableSettingsHeader:d,hasSelection:b,selectedCount:x,selectedRowsName:v,deleteSelectedPopupRef:y,tableSettingsRef:E,statusOptionsList:F,massEditorRef:M,massEditorTabs:S,massEditorParams:k,massEditorFields:R,paymentDetailsRef:w,refundPopupRef:C,refundType:P,refundTypeOptions:V,refundConfirmDisabled:T,onSelectionChanged:O,deselectAll:A,openDeletePopup:B,deleteSelected:U,openMassEditor:L,addMassEditorFieldsRow:c,changeTableSettings:Z}=Ee();return(Be,t)=>(H(),N(Q,null,[e("main",Re,[o(te,null,{default:i(()=>[o(g,{onClick:t[0]||(t[0]=s=>l(ke).push("/sessions"))},{default:i(()=>[...t[17]||(t[17]=[f("Сессии",-1)])]),_:1}),o(g,{class:"btn-filled"},{default:i(()=>[...t[18]||(t[18]=[f("Оплаты",-1)])]),_:1})]),_:1}),e("div",Te,[o(le,null,Se({right:i(()=>[o(g,{class:"small-btn",onClick:t[5]||(t[5]=s=>l($)(l(E)))},{default:i(()=>[...t[23]||(t[23]=[e("img",{src:pe},null,-1)])]),_:1}),o(g,{class:"small-btn"},{default:i(()=>[...t[24]||(t[24]=[e("img",{src:me},null,-1)])]),_:1})]),_:2},[l(b)==!0?{name:"left",fn:i(()=>[e("div",{class:"selected-count controller-item",onClick:t[1]||(t[1]=(...s)=>l(A)&&l(A)(...s))},[e("span",null,"Выбрано: "+W(l(x)),1),o(g,{class:"btn-filled"},{default:i(()=>[...t[19]||(t[19]=[e("img",{src:ie},null,-1)])]),_:1})]),e("div",{class:"delete-row controller-item",onClick:t[2]||(t[2]=(...s)=>l(B)&&l(B)(...s))},[...t[20]||(t[20]=[e("img",{src:G},null,-1),f(" Удалить ",-1)])]),e("div",{class:"edit controller-item",onClick:t[3]||(t[3]=(...s)=>l(L)&&l(L)(...s))},[...t[21]||(t[21]=[e("img",{src:re},null,-1),f(" Редактировать ",-1)])]),o(de,{class:"change-status controller-item","dropdown-list":l(F),onChange:t[4]||(t[4]=s=>console.log("Status changed to: ",s))},{default:i(()=>[...t[22]||(t[22]=[e("img",{src:ue},null,-1),f(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"])]),key:"0"}:void 0]),1024),o(se,{style:{"margin-top":"20px"},columns:l(u),data:l(p),onRowDblclick:t[6]||(t[6]=s=>l($)(l(w))),onSelectionChanged:l(O),ref_key:"mainTableRef",ref:r},null,8,["columns","data","onSelectionChanged"])])]),o(q,{ref_key:"deleteSelectedPopupRef",ref:y,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:l(U),onCancel:t[7]||(t[7]=s=>l(D)(l(y)))},{default:i(()=>[e("h2",$e,[t[25]||(t[25]=f(" Удалить сессии? ",-1)),t[26]||(t[26]=e("br",null,null,-1)),f(" "+W(l(v)),1)])]),_:1},8,["onConfirm"]),o(ne,{tabs:l(S),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:t[9]||(t[9]=s=>console.log("Changes saved!")),ref_key:"massEditorRef",ref:M},{edit:i(()=>[e("form",De,[t[29]||(t[29]=e("h3",null,"Редактирование выбранных объектов",-1)),t[30]||(t[30]=e("div",{class:"d-flex"},[e("span",{class:"fields-label"},"Параметр"),e("span",{class:"fields-label"},"До изменения"),e("span",{class:"fields-label"},"После изменения")],-1)),(H(!0),N(Q,null,we(l(R),(s,z)=>(H(),N("div",{class:"fields-row",key:z},[o(j,{options:l(k)},null,8,["options"]),o(j,{options:l(k)},null,8,["options"]),o(j,{options:l(k)},null,8,["options"]),e("button",{type:"button",class:"delete-row",onClick:Le=>l(R).splice(z,1)},[...t[27]||(t[27]=[e("img",{src:G},null,-1)])],8,Fe)]))),128)),e("button",{type:"button",class:"add-fields-btn",onClick:t[8]||(t[8]=(...s)=>l(c)&&l(c)(...s))},[...t[28]||(t[28]=[e("img",{src:ce},null,-1),f(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),o(oe,{"table-columns":l(d),onChange:t[10]||(t[10]=s=>l(Z)(s,l(n),l(r))),ref_key:"tableSettingsRef",ref:E},null,8,["table-columns"]),o(ae,{"inner-width":"515","custom-class":"payment-details",ref_key:"paymentDetailsRef",ref:w},{header:i(()=>[t[32]||(t[32]=e("h2",{class:"title"},"Детали оплаты, чек №0013",-1)),e("button",{class:"close-btn",onClick:t[11]||(t[11]=s=>l(D)(l(w)))},[...t[31]||(t[31]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:i(()=>[e("div",Me,[t[34]||(t[34]=e("div",{class:"top-box"},[e("p",null,[e("b",null,"60 000 ₽, 6.05.24, 08:15:05")])],-1)),t[35]||(t[35]=e("div",{class:"box"},[e("div",{class:"row"},[e("p",null,"Сумма"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"60 000 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:X})])])]),e("div",{class:"row row-error"},[e("p",null,"Дата и время"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"15.05.24, 12:01:05")])])]),e("div",{class:"row"},[e("p",null,"№ сессии"),e("p",null,[e("b",null,"1665423547316996")])]),e("div",{class:"row"},[e("p",null,"Тип оплаты"),e("p",null,[e("b",null,"Разовый въезд")])]),e("div",{class:"row"},[e("p",null,"Статус"),e("p",null,[e("b",null,"Успешно")])]),e("div",{class:"row"},[e("p",null,"Объект"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ТЦ “Ромашка”")]),e("button",{class:"icon link-icon"},[e("img",{src:I})])])]),e("div",{class:"row"},[e("p",null,"Клиент"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ООО “Шишмаойл”")]),e("button",{class:"icon link-icon"},[e("img",{src:I})])])]),e("div",{class:"row"},[e("p",null,"ID пользователя"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"09087754")]),e("button",{class:"icon link-icon"},[e("img",{src:I})])])])],-1)),o(g,{class:"refund-btn btn-filled",onClick:t[12]||(t[12]=s=>l($)(l(C)))},{default:i(()=>[...t[33]||(t[33]=[f(" Оформить возврат ",-1)])]),_:1})])]),_:1},512),o(q,{ref_key:"refundPopupRef",ref:C,"custom-class":"refund-payment-popup","confirm-text":"Подтвердить возврат","cancel-text":"Отмена","disabled-confirm-btn":l(T),onCancel:t[15]||(t[15]=s=>l(D)(l(C))),onConfirm:t[16]||(t[16]=s=>console.log("Возврат подтвержден"))},{default:i(()=>[t[37]||(t[37]=e("h2",{class:"popup-title"},"Возврат денежных средств",-1)),t[38]||(t[38]=e("div",{class:"row"},[e("p",null,"Сумма к возврату"),e("p",null,[e("b",null,"450 ₽")])],-1)),t[39]||(t[39]=e("div",{class:"row"},[e("p",null,"Номер чека"),e("p",null,[e("b",null,"12345")])],-1)),e("div",Ve,[e("div",Oe,[t[36]||(t[36]=e("p",null,"Причина возврата",-1)),o(l(fe),{modelValue:l(P),"onUpdate:modelValue":[t[13]||(t[13]=s=>Ce(P)?P.value=s:null),t[14]||(t[14]=s=>T.value=!1)],placeholder:"Выберите из списка",options:l(V),clearable:!1,searchable:!1,components:{OpenIndicator:be}},null,8,["modelValue","options","components"])])]),t[40]||(t[40]=e("div",{class:"comment"},[e("label",{for:"refund-comment"},"Комментарий:"),e("textarea",{name:"refund-comment",id:"refund-comment"})],-1))]),_:1},8,["disabled-confirm-btn"])],64))}},ze=ge(Ae,[["__scopeId","data-v-a9cc1191"]]);export{ze as default};
