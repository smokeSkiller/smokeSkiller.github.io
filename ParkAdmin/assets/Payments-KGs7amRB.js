import{_ as te,a as se,u as le,T as ne,P as oe,b as ae,c as Q,d as ie,B as re,e as ue,f as W,g as de,h as me,k as pe,O as ce}from"./FilterSortDate-C6tpu_jT.js";import{T as fe,_ as be,D as ve,a as ye,b as z,c as ge}from"./DropdownRadio-e-zbt9qg.js";import{C as ke,_ as Se}from"./CalculatedSummary-B3cZLPfF.js";import{a as h,_ as q}from"./note-icon-CfdApiIo.js";import{o as A,c as T}from"./modal-DRTCzFhK.js";import{s as Ce,x as X,e as r,y as we,i as Y,_ as xe,c as G,a as e,b as o,w as i,g as Pe,z as $e,A as Re,u as s,F as Z,o as I,B as Ee,d as f,t as _,j as Te,C as De}from"./index-CHysKgRS.js";import{B as k}from"./BaseButton-C7MmaeKG.js";const ee=Ce("payments",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"sum",title:"Сумма",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"payment-time",title:"Время оплаты",headerSort:!1},{field:"payment-type",title:"Тип оплаты",headerSort:!1},{field:"check",title:"Чек",headerSort:!1,formatter:function(a){return`
                            <div class="check-cell">
                                <span>${a.getValue()}</span>
                                <button class="check-btn">
                                    <img src="${h}" />
                                </button>
                            </div>
                        `},cellClick:(a,n)=>{if(a.target.closest(".check-btn")){const u=n.getValue();console.log("Нажали на кнопку чека:",u)}}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(a){const n=a.getValue();return{paid:'<span class="status status-paid">Успешно</span>',refunded:'<span class="status status-canceled">Возвращён</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}}],content:[{sum:450,id:1,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:6e4,id:2,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"canceled"},{sum:1200,id:3,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"},{sum:700,id:4,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:23e3,id:5,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"paid"},{sum:2100,id:6,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function Me(){return{applyFiltersToColumns:(n,u,c)=>u.map(d=>d.field==="id"?{...d,headerClickPopup(){const m=document.createElement("div");return X(te,{onSelectSortOrder(){c(n,"id")}}).mount(m),m}}:d.field==="payment-time"?{...d,headerClickPopup(){const m=document.createElement("div");return X(se,{onSelectSortOrder(){c(n,"payment-time")},onSelectCompareState(){c(n,"payment-time")},onSelectDate(){c(n,"payment-time")},onSelectDateRange(){c(n,"payment-time")}}).mount(m),m}}:d)}}function Ve(a){const n=ee(),u=r(null),c=r([{name:"edit",label:"Массовое редактирование"}]),d=r(n.massEditor.params),m=we([{}]);return{massEditorRef:u,massEditorTabs:c,massEditorParams:d,massEditorFields:m,openMassEditor:()=>a.openMassEditor(u),addMassEditorFieldsRow:()=>a.addMassEditorFieldsRow(m)}}function Fe(){const a=ee(),n=le(),{hasSelection:u,selectedCount:c,selectedRows:d,selectedRowsName:m,changeTableSettings:v,addResetFilterBtn:S}=n,y=r(null),g=Y(()=>a.mainTable.columns),D=Y(()=>a.mainTable.content),L=r(null),M=g.value.filter(p=>p.formatter!=="rowSelection").map(p=>({field:p.field,title:p.title})),C=r(null),V=r([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:N}=Me();a.mainTable.columns=N(y,g.value,S);const w=Ve(n),x=r([]),b=r(!1),P=r(null),$=r(null),j=r(""),F=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],H=r(!0);const R=()=>n.deselectAll(y),O=()=>n.deleteSelected(y,()=>T(C.value)),U=()=>A(C.value),B=p=>{n.onSelectionChanged(p,"id"),b.value&&E()},E=()=>{b.value=!0,x.value=d.value.map(p=>({name:p["payment-type"],average_sum:p.sum,total_sum:p.sum}))};return{paymentsStore:a,mainTableRef:y,tableHeader:g,tableContent:D,tableSettingsHeader:M,hasSelection:u,selectedCount:c,selectedRows:d,selectedRowsName:m,deleteSelectedPopupRef:C,tableSettingsRef:L,statusOptionsList:V,showCalculatedSummary:b,summaryItems:x,paymentDetailsRef:P,refundPopupRef:$,refundType:j,refundTypeOptions:F,refundConfirmDisabled:H,...w,onSelectionChanged:B,deselectAll:R,calculateSummaryItems:E,deleteSelected:O,changeTableSettings:v,openDeletePopup:U}}const Oe={class:"page"},Be={class:"page-content"},Ie={class:"popup-title"},Ae={action:"#"},Le=["onClick"],Ne={class:"content-inner"},je={class:"w-100",style:{margin:"20px 0"}},He={class:"row refund-select"},Ue={__name:"Payments",setup(a){const{paymentsStore:n,mainTableRef:u,tableHeader:c,tableContent:d,tableSettingsHeader:m,hasSelection:v,selectedCount:S,selectedRowsName:y,deleteSelectedPopupRef:g,tableSettingsRef:D,statusOptionsList:L,showCalculatedSummary:M,summaryItems:C,massEditorRef:V,massEditorTabs:N,massEditorParams:w,massEditorFields:x,paymentDetailsRef:b,refundPopupRef:P,refundType:$,refundTypeOptions:j,refundConfirmDisabled:F,onSelectionChanged:H,deselectAll:R,openDeletePopup:O,deleteSelected:U,openMassEditor:B,addMassEditorFieldsRow:E,changeTableSettings:p,calculateSummaryItems:J}=Fe();return(ze,t)=>(I(),G(Z,null,[e("main",Oe,[o(ne,null,{default:i(()=>[o(k,{onClick:t[0]||(t[0]=l=>s(Ee).push("/sessions"))},{default:i(()=>[...t[20]||(t[20]=[f("Сессии",-1)])]),_:1}),o(k,{class:"btn-filled"},{default:i(()=>[...t[21]||(t[21]=[f("Оплаты",-1)])]),_:1})]),_:1}),e("div",Be,[o(oe,null,Re({right:i(()=>[o(k,{class:"small-btn",onClick:t[6]||(t[6]=l=>s(A)(s(D)))},{default:i(()=>[...t[27]||(t[27]=[e("img",{src:de},null,-1)])]),_:1}),o(k,{class:"small-btn"},{default:i(()=>[...t[28]||(t[28]=[e("img",{src:me},null,-1)])]),_:1})]),_:2},[s(v)==!0?{name:"left",fn:i(()=>[e("div",{class:"selected-count controller-item",onClick:t[1]||(t[1]=(...l)=>s(R)&&s(R)(...l))},[e("span",null,"Выбрано: "+_(s(S)),1),o(k,{class:"btn-filled"},{default:i(()=>[...t[22]||(t[22]=[e("img",{src:ue},null,-1)])]),_:1})]),e("div",{class:"delete-row controller-item",onClick:t[2]||(t[2]=(...l)=>s(O)&&s(O)(...l))},[...t[23]||(t[23]=[e("img",{src:W},null,-1),f(" Удалить ",-1)])]),e("div",{class:"edit controller-item",onClick:t[3]||(t[3]=(...l)=>s(B)&&s(B)(...l))},[...t[24]||(t[24]=[e("img",{src:be},null,-1),f(" Редактировать ",-1)])]),o(ve,{class:"change-status controller-item","dropdown-list":s(L),onChange:t[4]||(t[4]=l=>console.log("Status changed to: ",l))},{default:i(()=>[...t[25]||(t[25]=[e("img",{src:ye},null,-1),f(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"]),e("div",{class:"summary controller-item",onClick:t[5]||(t[5]=(...l)=>s(J)&&s(J)(...l))},[...t[26]||(t[26]=[e("img",{src:Se},null,-1),f(" Сумма ",-1)])])]),key:"0"}:void 0]),1024),s(M)?(I(),Pe(ke,{key:0,"selected-text":`${s(S)} оплаты`,"title-text":"Данные по выбранным оплатам:",items:s(C),onReset:t[7]||(t[7]=l=>(M.value=!1,s(R)()))},null,8,["selected-text","items"])):$e("",!0),o(ae,{style:{"margin-top":"20px"},columns:s(c),data:s(d),onRowDblclick:t[8]||(t[8]=l=>s(A)(s(b))),onSelectionChanged:s(H),ref_key:"mainTableRef",ref:u},null,8,["columns","data","onSelectionChanged"])])]),o(Q,{ref_key:"deleteSelectedPopupRef",ref:g,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:s(U),onCancel:t[9]||(t[9]=l=>s(T)(s(g)))},{default:i(()=>[e("h2",Ie,[t[29]||(t[29]=f(" Удалить сессии? ",-1)),t[30]||(t[30]=e("br",null,null,-1)),f(" "+_(s(y)),1)])]),_:1},8,["onConfirm"]),o(fe,{tabs:s(N),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:t[11]||(t[11]=l=>console.log("Changes saved!")),onCloseClick:t[12]||(t[12]=l=>s(T)(s(V))),ref_key:"massEditorRef",ref:V},{edit:i(()=>[e("form",Ae,[t[33]||(t[33]=e("h3",null,"Редактирование выбранных объектов",-1)),t[34]||(t[34]=e("div",{class:"d-flex"},[e("span",{class:"fields-label"},"Параметр"),e("span",{class:"fields-label"},"До изменения"),e("span",{class:"fields-label"},"После изменения")],-1)),(I(!0),G(Z,null,Te(s(x),(l,K)=>(I(),G("div",{class:"fields-row",key:K},[o(z,{options:s(w)},null,8,["options"]),o(z,{options:s(w)},null,8,["options"]),o(z,{options:s(w)},null,8,["options"]),e("button",{type:"button",class:"delete-row",onClick:qe=>s(x).splice(K,1)},[...t[31]||(t[31]=[e("img",{src:W},null,-1)])],8,Le)]))),128)),e("button",{type:"button",class:"add-fields-btn",onClick:t[10]||(t[10]=(...l)=>s(E)&&s(E)(...l))},[...t[32]||(t[32]=[e("img",{src:ge},null,-1),f(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),o(ie,{"table-columns":s(m),onChange:t[13]||(t[13]=l=>s(p)(l,s(n),s(u))),ref_key:"tableSettingsRef",ref:D},null,8,["table-columns"]),o(re,{"inner-width":"515","custom-class":"payment-details",ref_key:"paymentDetailsRef",ref:b},{header:i(()=>[t[36]||(t[36]=e("h2",{class:"title"},"Детали оплаты, чек №0013",-1)),e("button",{class:"close-btn",onClick:t[14]||(t[14]=l=>s(T)(s(b)))},[...t[35]||(t[35]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:i(()=>[e("div",Ne,[t[38]||(t[38]=e("div",{class:"top-box"},[e("p",null,[e("b",null,"60 000 ₽, 6.05.24, 08:15:05")])],-1)),t[39]||(t[39]=e("div",{class:"box"},[e("div",{class:"row"},[e("p",null,"Сумма"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"60 000 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:h})])])]),e("div",{class:"row row-error"},[e("p",null,"Дата и время"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"15.05.24, 12:01:05")])])]),e("div",{class:"row"},[e("p",null,"№ сессии"),e("p",null,[e("b",null,"1665423547316996")])]),e("div",{class:"row"},[e("p",null,"Тип оплаты"),e("p",null,[e("b",null,"Разовый въезд")])]),e("div",{class:"row"},[e("p",null,"Статус"),e("p",null,[e("b",null,"Успешно")])]),e("div",{class:"row"},[e("p",null,"Объект"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ТЦ “Ромашка”")]),e("button",{class:"icon link-icon"},[e("img",{src:q})])])]),e("div",{class:"row"},[e("p",null,"Клиент"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ООО “Шишмаойл”")]),e("button",{class:"icon link-icon"},[e("img",{src:q})])])]),e("div",{class:"row"},[e("p",null,"ID пользователя"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"09087754")]),e("button",{class:"icon link-icon"},[e("img",{src:q})])])])],-1)),o(k,{class:"refund-btn btn-filled",onClick:t[15]||(t[15]=l=>s(A)(s(P)))},{default:i(()=>[...t[37]||(t[37]=[f(" Оформить возврат ",-1)])]),_:1})])]),_:1},512),o(Q,{ref_key:"refundPopupRef",ref:P,"custom-class":"refund-payment-popup","confirm-text":"Подтвердить возврат","cancel-text":"Отмена","disabled-confirm-btn":s(F),onCancel:t[18]||(t[18]=l=>s(T)(s(P))),onConfirm:t[19]||(t[19]=l=>console.log("Возврат подтвержден"))},{default:i(()=>[t[41]||(t[41]=e("h2",{class:"popup-title"},"Возврат денежных средств",-1)),t[42]||(t[42]=e("div",{class:"row"},[e("p",null,"Сумма к возврату"),e("p",null,[e("b",null,"450 ₽")])],-1)),t[43]||(t[43]=e("div",{class:"row"},[e("p",null,"Номер чека"),e("p",null,[e("b",null,"12345")])],-1)),e("div",je,[e("div",He,[t[40]||(t[40]=e("p",null,"Причина возврата",-1)),o(s(pe),{modelValue:s($),"onUpdate:modelValue":[t[16]||(t[16]=l=>De($)?$.value=l:null),t[17]||(t[17]=l=>F.value=!1)],placeholder:"Выберите из списка",options:s(j),clearable:!1,searchable:!1,components:{OpenIndicator:ce}},null,8,["modelValue","options","components"])])]),t[44]||(t[44]=e("div",{class:"comment"},[e("label",{for:"refund-comment"},"Комментарий:"),e("textarea",{name:"refund-comment",id:"refund-comment"})],-1))]),_:1},8,["disabled-confirm-btn"])],64))}},Ze=xe(Ue,[["__scopeId","data-v-614a3271"]]);export{Ze as default};
