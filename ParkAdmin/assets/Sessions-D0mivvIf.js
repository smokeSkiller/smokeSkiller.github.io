import{_ as oe}from"./close-icon-DcnZ6QH4.js";import{_ as J,u as ie,P as ae,a as re,B as Q,b as X,c as ue,d as Y,e as de,f as me}from"./vue-3-slider-component-CbaC0ZGR.js";import{_ as pe,D as fe,a as ce}from"./DropdownRadio-BAhia4Xe.js";import{C as be,_ as ve}from"./CalculatedSummary-BZKp5kui.js";import{_ as w,a as U}from"./note-icon-CfdApiIo.js";import{_ as ge}from"./plus-icon-lxHPDhbU.js";import{T as Se}from"./TableModal-BpXQBRhF.js";import{o as $,c as E}from"./modal-DRTCzFhK.js";import{s as we,x as O,e as b,y as ke,i as Z,_ as Ce,c as K,a as e,b as i,w as u,g as _,z as h,u as s,A as ye,F as ee,o as P,d as m,B as xe,t as te,n as $e,j as Ee}from"./index-B567c83m.js";import{T as De,k as Me}from"./CustomOpenIndicator-DBeq1Fbz.js";import{B as x}from"./BaseButton-DTRLxGU6.js";import{_ as W}from"./FormSelectField-CkD8ax8O.js";import{_ as se}from"./FilterSortDate-D6o0gEk7.js";const le=we("sessions",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"object-name",title:"Объект",headerSort:!1,width:140},{field:"vehicle-number",title:"Номер ТС",headerSort:!1,width:150},{field:"enter-time",title:"Время въезда",headerSort:!1},{field:"exit-time",title:"Время выезда",headerSort:!1},{field:"duration",title:"Длительность",headerSort:!1,width:135,formatter:function(d){const n=Number(d.getValue());if(!n||isNaN(n))return"—";const f=Math.floor(n/3600),a=Math.floor(n%3600/60),r=n%60,o=c=>c.toString().padStart(2,"0");return`${o(f)}:${o(a)}:${o(r)}`}},{field:"total",title:"Сумма",headerSort:!1,width:200,formatter:function(d){return`${d.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(d){const n=d.getValue();return{paid:'<span class="status status-paid">Оплачена</span>',active:'<span class="status status-active">Активна</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}}],content:[{id:1,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:5400,status:"paid",total:450},{id:2,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1e3,status:"active",total:600},{id:3,"object-name":"ТЦ Мега","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:1200,status:"canceled",total:500},{id:4,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:2400,status:"paid",total:450},{id:5,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1500,status:"active",total:400}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function je(){return{applyFiltersToColumns:(n,f,a)=>f.map(r=>r.field==="id"?{...r,headerClickPopup(){const o=document.createElement("div");return O(J,{onSelectSortOrder(){a(n,"id")}}).mount(o),o}}:r.field==="object-name"?{...r,headerClickPopup(){const o=document.createElement("div");return O(J,{onSelectSortOrder(){a(n,"object-name")}}).mount(o),o}}:r.field==="enter-time"?{...r,headerClickPopup(){const o=document.createElement("div");return O(se,{onSelectSortOrder(){a(n,"enter-time")},onSelectCompareState(){a(n,"enter-time")},onSelectDate(){a(n,"enter-time")},onSelectDateRange(){a(n,"enter-time")}}).mount(o),o}}:r.field==="exit-time"?{...r,headerClickPopup(){const o=document.createElement("div");return O(se,{onSelectSortOrder(){a(n,"exit-time")},onSelectCompareState(){a(n,"exit-time")},onSelectDate(){a(n,"exit-time")},onSelectDateRange(){a(n,"exit-time")}}).mount(o),o}}:r)}}function Pe(d){const n=le(),f=b(null),a=b([{name:"edit",label:"Массовое редактирование"}]),r=b(n.massEditor.params),o=ke([{}]);return{massEditorRef:f,massEditorTabs:a,massEditorParams:r,massEditorFields:o,openMassEditor:()=>d.openMassEditor(f),addMassEditorFieldsRow:()=>d.addMassEditorFieldsRow(o)}}function Re(){const d=le(),n=ie(),{hasSelection:f,selectedCount:a,selectedRows:r,selectedRowsName:o,changeTableSettings:c,addResetFilterBtn:g}=n,v=b(null),D=Z(()=>d.mainTable.columns),R=Z(()=>d.mainTable.content),A=b(null),T=b(null);b(null);const V=b(null),F=D.value.filter(p=>p.formatter!=="rowSelection").map(p=>({field:p.field,title:p.title})),S=b(null),L=b([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:I}=je();d.mainTable.columns=I(v,D.value,g);const B=Pe(n),k=b([]),C=b(!1),H=()=>n.deselectAll(v),M=()=>n.deleteSelected(v,()=>E(S.value)),N=()=>$(S.value),z=p=>{n.onSelectionChanged(p,"id"),C.value&&j()},j=()=>{C.value=!0,k.value=r.value.map(p=>({name:p["object-name"],average_length:p.duration,average_sum:p.total,total_sum:p.total}))};return{sessionsStore:d,mainTableRef:v,tableHeader:D,tableContent:R,tableSettingsHeader:F,sessionDetailsRef:A,paymentDetailsRef:T,hasSelection:f,selectedCount:a,selectedRows:r,selectedRowsName:o,deleteSelectedPopupRef:S,tableSettingsRef:V,statusOptionsList:L,showCalculatedSummary:C,summaryItems:k,...B,onSelectionChanged:z,deselectAll:H,deleteSelected:M,changeTableSettings:c,calculateSummaryItems:j,openDeletePopup:N}}const Te="/ParkAdmin/assets/session-CFWKBI7c.png",Ve={class:"page"},Ie={class:"page-content"},Ne={class:"content-inner"},Oe={class:"top-box"},Ae={class:"box"},Fe={class:"row"},Le={class:"d-flex align-items-center"},Be={class:"row"},He={class:"d-flex align-items-center"},ze={class:"content-inner"},Ue={class:"popup-title"},Ke={class:"w-100",style:{margin:"20px 0"}},We={class:"row refund-select"},qe={action:"#"},Ge=["onClick"],Je={__name:"Sessions",setup(d){const{sessionsStore:n,mainTableRef:f,tableHeader:a,tableContent:r,tableSettingsHeader:o,sessionDetailsRef:c,paymentDetailsRef:g,refundPopupRef:v,hasSelection:D,selectedCount:R,selectedRowsName:A,deleteSelectedPopupRef:T,tableSettingsRef:V,statusOptionsList:F,showCalculatedSummary:S,summaryItems:L,massEditorRef:I,massEditorTabs:B,massEditorParams:k,massEditorFields:C,onSelectionChanged:H,deselectAll:M,openDeletePopup:N,deleteSelected:z,openMassEditor:j,addMassEditorFieldsRow:p,changeTableSettings:ne,calculateSummaryItems:q}=Re();return(y,t)=>(P(),K(ee,null,[e("main",Ve,[i(De,null,{default:u(()=>[i(x,{class:"btn-filled"},{default:u(()=>[...t[23]||(t[23]=[m("Сессии",-1)])]),_:1}),i(x,{onClick:t[0]||(t[0]=l=>s(xe).push("/payments"))},{default:u(()=>[...t[24]||(t[24]=[m("Оплаты",-1)])]),_:1})]),_:1}),e("div",Ie,[s(S)?h("",!0):(P(),_(ae,{key:0},ye({right:u(()=>[i(x,{class:"small-btn",onClick:t[6]||(t[6]=l=>s($)(s(V)))},{default:u(()=>[...t[30]||(t[30]=[e("img",{src:de},null,-1)])]),_:1}),i(x,{class:"small-btn"},{default:u(()=>[...t[31]||(t[31]=[e("img",{src:me},null,-1)])]),_:1})]),_:2},[s(D)==!0?{name:"left",fn:u(()=>[e("div",{class:"selected-count controller-item",onClick:t[1]||(t[1]=(...l)=>s(M)&&s(M)(...l))},[e("span",null,"Выбрано: "+te(s(R)),1),i(x,{class:"btn-filled"},{default:u(()=>[...t[25]||(t[25]=[e("img",{src:oe},null,-1)])]),_:1})]),e("div",{class:"delete-row controller-item",onClick:t[2]||(t[2]=(...l)=>s(N)&&s(N)(...l))},[...t[26]||(t[26]=[e("img",{src:Y},null,-1),m(" Удалить ",-1)])]),e("div",{class:"edit controller-item",onClick:t[3]||(t[3]=(...l)=>s(j)&&s(j)(...l))},[...t[27]||(t[27]=[e("img",{src:pe},null,-1),m(" Редактировать ",-1)])]),i(fe,{class:"change-status controller-item","dropdown-list":s(F),onChange:t[4]||(t[4]=l=>console.log("Status changed to: ",l))},{default:u(()=>[...t[28]||(t[28]=[e("img",{src:ce},null,-1),m(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"]),e("div",{class:"summary controller-item",onClick:t[5]||(t[5]=(...l)=>s(q)&&s(q)(...l))},[...t[29]||(t[29]=[e("img",{src:ve},null,-1),m(" Сумма ",-1)])])]),key:"0"}:void 0]),1024)),s(S)?(P(),_(be,{key:1,"selected-text":`${s(R)} сессии`,"title-text":"Данные по выбранным сессиям:",items:s(L),onReset:t[7]||(t[7]=l=>(S.value=!1,s(M)()))},null,8,["selected-text","items"])):h("",!0),i(re,{style:{"margin-top":"20px"},columns:s(a),data:s(r),onRowDblclick:t[8]||(t[8]=l=>s($)(s(c))),onSelectionChanged:s(H),ref_key:"mainTableRef",ref:f},null,8,["columns","data","onSelectionChanged"])])]),i(Q,{"inner-width":"515","custom-class":"session-details",ref_key:"sessionDetailsRef",ref:c},{header:u(()=>[t[33]||(t[33]=e("h2",{class:"title"},"Сессия №1665423547316996",-1)),e("button",{class:"close-btn",onClick:t[9]||(t[9]=l=>s(E)(s(c)))},[...t[32]||(t[32]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:u(()=>[e("div",Ne,[e("div",Oe,[e("div",{class:"img",style:$e({"background-image":`url(${s(Te)})`})},null,4),t[34]||(t[34]=e("div",{class:"content"},[e("p",null,[m(" Номер ТС: "),e("b",null,"М969ММ777")]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[m("Объект: "),e("b",null,"ТЦ “Мега”")]),e("button",{class:"icon link-icon"},[e("img",{src:w})])]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[m("Клиент: "),e("b",null,"ООО Ирбис")]),e("button",{class:"icon link-icon"},[e("img",{src:w})])]),e("p",null,[m("Статус: "),e("b",null,"Оплачена")]),e("p",null,[m("Продолжительность: "),e("b",null,"02:44:26")])],-1))]),t[45]||(t[45]=e("div",{class:"box"},[e("h4",null,"Въезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1)),e("div",Ae,[t[43]||(t[43]=e("h4",null,"Оплата:",-1)),e("div",Fe,[t[38]||(t[38]=e("p",null,"04.11.2025, 15:50:31, Банковская карта ****1234",-1)),e("div",Le,[t[36]||(t[36]=e("p",null,[e("b",null,"450 ₽")],-1)),t[37]||(t[37]=e("button",{class:"icon copy-icon"},[e("img",{src:U})],-1)),e("button",{class:"icon link-icon",onClick:t[10]||(t[10]=l=>s($)(s(g)))},[...t[35]||(t[35]=[e("img",{src:w},null,-1)])])])]),t[44]||(t[44]=e("div",{class:"row row-error"},[e("p",null,"04.11.2025, 15:54:17, Банковская карта ****5990"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"450 ₽, ошибка оплаты")])])],-1)),e("div",Be,[t[42]||(t[42]=e("p",null,"04.11.2025, 16:03:14, Касса №2009",-1)),e("div",He,[t[40]||(t[40]=e("p",null,[e("b",null,"450 ₽")],-1)),t[41]||(t[41]=e("button",{class:"icon copy-icon"},[e("img",{src:U})],-1)),e("button",{class:"icon link-icon",onClick:t[11]||(t[11]=l=>s($)(s(g)))},[...t[39]||(t[39]=[e("img",{src:w},null,-1)])])])])]),t[46]||(t[46]=e("div",{class:"box"},[e("h4",null,"Выезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1))])]),_:1},512),i(Q,{"inner-width":"515","custom-class":"payment-details",ref_key:"paymentDetailsRef",ref:g},{header:u(()=>[t[48]||(t[48]=e("h2",{class:"title"},"Детали оплаты, чек №0013",-1)),e("button",{class:"close-btn",onClick:t[12]||(t[12]=l=>s(E)(s(g)))},[...t[47]||(t[47]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:u(()=>[e("div",ze,[t[50]||(t[50]=e("div",{class:"top-box"},[e("p",null,[e("b",null,"60 000 ₽, 6.05.24, 08:15:05")])],-1)),t[51]||(t[51]=e("div",{class:"box"},[e("div",{class:"row"},[e("p",null,"Сумма"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"60 000 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:U})])])]),e("div",{class:"row row-error"},[e("p",null,"Дата и время"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"15.05.24, 12:01:05")])])]),e("div",{class:"row"},[e("p",null,"№ сессии"),e("p",null,[e("b",null,"1665423547316996")])]),e("div",{class:"row"},[e("p",null,"Тип оплаты"),e("p",null,[e("b",null,"Разовый въезд")])]),e("div",{class:"row"},[e("p",null,"Статус"),e("p",null,[e("b",null,"Успешно")])]),e("div",{class:"row"},[e("p",null,"Объект"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ТЦ “Ромашка”")]),e("button",{class:"icon link-icon"},[e("img",{src:w})])])]),e("div",{class:"row"},[e("p",null,"Клиент"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"ООО “Шишмаойл”")]),e("button",{class:"icon link-icon"},[e("img",{src:w})])])]),e("div",{class:"row"},[e("p",null,"ID пользователя"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"09087754")]),e("button",{class:"icon link-icon"},[e("img",{src:w})])])])],-1)),i(x,{class:"refund-btn btn-filled",onClick:t[13]||(t[13]=l=>s($)(s(v)))},{default:u(()=>[...t[49]||(t[49]=[m(" Оформить возврат ",-1)])]),_:1})])]),_:1},512),i(X,{ref_key:"deleteSelectedPopupRef",ref:T,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:s(z),onCancel:t[14]||(t[14]=l=>s(E)(s(T)))},{default:u(()=>[e("h2",Ue,[t[52]||(t[52]=m(" Удалить сессии? ",-1)),t[53]||(t[53]=e("br",null,null,-1)),m(" "+te(s(A)),1)])]),_:1},8,["onConfirm"]),i(X,{ref_key:"refundPopupRef",ref:v,"custom-class":"refund-payment-popup","confirm-text":"Подтвердить возврат","cancel-text":"Отмена","disabled-confirm-btn":y.refundConfirmDisabled,onCancel:t[17]||(t[17]=l=>s(E)(s(v))),onConfirm:t[18]||(t[18]=l=>console.log("Возврат подтвержден"))},{default:u(()=>[t[55]||(t[55]=e("h2",{class:"popup-title"},"Возврат денежных средств",-1)),t[56]||(t[56]=e("div",{class:"row"},[e("p",null,"Сумма к возврату"),e("p",null,[e("b",null,"450 ₽")])],-1)),t[57]||(t[57]=e("div",{class:"row"},[e("p",null,"Номер чека"),e("p",null,[e("b",null,"12345")])],-1)),e("div",Ke,[e("div",We,[t[54]||(t[54]=e("p",null,"Причина возврата",-1)),i(s(Me),{modelValue:y.refundType,"onUpdate:modelValue":[t[15]||(t[15]=l=>y.refundType=l),t[16]||(t[16]=l=>y.refundConfirmDisabled=!1)],placeholder:"Выберите из списка",options:y.refundTypeOptions,clearable:!1,searchable:!1,components:{OpenIndicator:y.OpenIndicator}},null,8,["modelValue","options","components"])])]),t[58]||(t[58]=e("div",{class:"comment"},[e("label",{for:"refund-comment"},"Комментарий:"),e("textarea",{name:"refund-comment",id:"refund-comment"})],-1))]),_:1},8,["disabled-confirm-btn"]),i(Se,{tabs:s(B),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:t[20]||(t[20]=l=>console.log("Changes saved!")),onCloseClick:t[21]||(t[21]=l=>s(E)(s(I))),ref_key:"massEditorRef",ref:I},{edit:u(()=>[e("form",qe,[t[61]||(t[61]=e("h3",null,"Редактирование выбранных объектов",-1)),t[62]||(t[62]=e("div",{class:"d-flex"},[e("span",{class:"fields-label"},"Параметр"),e("span",{class:"fields-label"},"До изменения"),e("span",{class:"fields-label"},"После изменения")],-1)),(P(!0),K(ee,null,Ee(s(C),(l,G)=>(P(),K("div",{class:"fields-row",key:G},[i(W,{options:s(k)},null,8,["options"]),i(W,{options:s(k)},null,8,["options"]),i(W,{options:s(k)},null,8,["options"]),e("button",{type:"button",class:"delete-row",onClick:Qe=>s(C).splice(G,1)},[...t[59]||(t[59]=[e("img",{src:Y},null,-1)])],8,Ge)]))),128)),e("button",{type:"button",class:"add-fields-btn",onClick:t[19]||(t[19]=(...l)=>s(p)&&s(p)(...l))},[...t[60]||(t[60]=[e("img",{src:ge},null,-1),m(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),i(ue,{"table-columns":s(o),onChange:t[22]||(t[22]=l=>s(ne)(l,s(n),s(f))),ref_key:"tableSettingsRef",ref:V},null,8,["table-columns"])],64))}},rt=Ce(Je,[["__scopeId","data-v-586349a7"]]);export{rt as default};
