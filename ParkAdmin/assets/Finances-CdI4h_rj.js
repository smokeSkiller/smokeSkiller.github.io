import{_ as z}from"./close-icon-DcnZ6QH4.js";import{f as j,u as q,P as G,c as J,d as K,e as Q,_ as W,a as X,b as Y}from"./vue-3-slider-component-lab0IWlZ.js";import{_ as Z}from"./summary-icon-BZQwzDv_.js";import{A as ee,B as V,e as i,i as A,_ as te,c as ne,a as l,b as u,w as d,g as se,x as le,s as ae,u as t,F as oe,o as N,y as re,d as v,t as B}from"./index-iaVJZ9tw.js";import{B as k}from"./BaseButton-CNUrt7E6.js";import{o as I,c as h}from"./modal-DRTCzFhK.js";import{T as ie}from"./CustomOpenIndicator-DDrFPNUG.js";import{C as ue}from"./CalculatedSummary-DJJDBlVZ.js";import{_ as pe}from"./FilterSortDate-CuMhXrGb.js";const ce=ee("finances",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"date",title:"Дата",headerSort:!1,width:150},{field:"client",title:"Клиент",headerSort:!1,width:150},{field:"period",title:"Период",headerSort:!1},{field:"revenue",title:"Выручка",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"pp",title:"% удержания",headerSort:!1},{field:"price",title:"К выплате",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(a){const n=a.getValue();return{paid:'<span class="status status-paid">Выплачено</span>',processing:'<span class="status status-active">В процессе</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}},{field:"bank",title:"Банк",headerSort:!1}],content:[{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"}]}})});function de(){return{applyFiltersToColumns:(n,m,p)=>m.map(r=>r.field==="client"?{...r,headerClickPopup(){const c=document.createElement("div");return V(j,{onSelectSortOrder(){p(n,"id")}}).mount(c),c}}:r.field==="period"?{...r,headerClickPopup(){const c=document.createElement("div");return V(pe,{onSelectSortOrder(){p(n,"payment-time")},onSelectCompareState(){p(n,"payment-time")},onSelectDate(){p(n,"payment-time")},onSelectDateRange(){p(n,"payment-time")}}).mount(c),c}}:r)}}function me(){const a=ce(),n=q(),{hasSelection:m,selectedCount:p,selectedRows:r,selectedRowsName:c,changeTableSettings:b,addResetFilterBtn:_}=n,f=i(null),S=A(()=>a.mainTable.columns),T=A(()=>a.mainTable.content),$=i(null),w=S.value.filter(o=>o.formatter!=="rowSelection").map(o=>({field:o.field,title:o.title})),C=i(null),y=i([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:x}=de();a.mainTable.columns=x(f,S.value,_);const P=i(null),F=i([]),g=i(!1),D=i(null),e=i(""),s=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],H=i(!0);const O=()=>n.deselectAll(f),E=()=>n.deleteSelected(f,()=>h(C.value)),L=()=>I(C.value),U=o=>{n.onSelectionChanged(o,"id"),g.value&&R()},R=()=>{g.value=!0,F.value=r.value.map(o=>{const M=o.status==="processing"?o.price:0;return{name:o.client,in_process:M,average_sum:o.revenue,total_sum:o.price}})};return{financesStore:a,mainTableRef:f,tableHeader:S,tableContent:T,tableSettingsHeader:w,hasSelection:m,selectedCount:p,selectedRows:r,selectedRowsName:c,deleteSelectedPopupRef:C,summaryItems:F,showCalculatedSummary:g,tableSettingsRef:$,statusOptionsList:y,paymentDetailsRef:P,refundPopupRef:D,refundType:e,refundTypeOptions:s,refundConfirmDisabled:H,onSelectionChanged:U,deselectAll:O,deleteSelected:E,changeTableSettings:b,openDeletePopup:L,calculateSummaryItems:R}}const fe={class:"page"},Se={class:"page-content"},ge={class:"popup-title"},ve={__name:"Finances",setup(a){const{financesStore:n,mainTableRef:m,tableHeader:p,tableContent:r,tableSettingsHeader:c,hasSelection:b,selectedCount:_,selectedRowsName:f,deleteSelectedPopupRef:S,tableSettingsRef:T,summaryItems:$,showCalculatedSummary:w,onSelectionChanged:C,deselectAll:y,openDeletePopup:x,deleteSelected:P,changeTableSettings:F,calculateSummaryItems:g}=me();return(D,e)=>(N(),ne(oe,null,[l("main",fe,[u(ie,null,{default:d(()=>[u(k,{onClick:e[0]||(e[0]=s=>t(re).push("/clients"))},{default:d(()=>[...e[8]||(e[8]=[v("Клиенты",-1)])]),_:1}),u(k,{class:"btn-filled"},{default:d(()=>[...e[9]||(e[9]=[v("Финансы",-1)])]),_:1})]),_:1}),l("div",Se,[u(G,null,ae({right:d(()=>[u(k,{class:"small-btn",onClick:e[4]||(e[4]=s=>t(I)(t(T)))},{default:d(()=>[...e[13]||(e[13]=[l("img",{src:X},null,-1)])]),_:1}),u(k,{class:"small-btn"},{default:d(()=>[...e[14]||(e[14]=[l("img",{src:Y},null,-1)])]),_:1})]),_:2},[t(b)==!0?{name:"left",fn:d(()=>[l("div",{class:"selected-count controller-item",onClick:e[1]||(e[1]=(...s)=>t(y)&&t(y)(...s))},[l("span",null,"Выбрано: "+B(t(_)),1),u(k,{class:"btn-filled"},{default:d(()=>[...e[10]||(e[10]=[l("img",{src:z},null,-1)])]),_:1})]),l("div",{class:"delete-row controller-item",onClick:e[2]||(e[2]=(...s)=>t(x)&&t(x)(...s))},[...e[11]||(e[11]=[l("img",{src:W},null,-1),v(" Удалить ",-1)])]),l("div",{class:"summary controller-item",onClick:e[3]||(e[3]=(...s)=>t(g)&&t(g)(...s))},[...e[12]||(e[12]=[l("img",{src:Z},null,-1),v(" Сумма ",-1)])])]),key:"0"}:void 0]),1024),t(w)?(N(),se(ue,{key:0,"selected-text":`${t(_)} выплаты`,"title-text":"Данные по выбранным финансам:",items:t($),onReset:e[5]||(e[5]=s=>(w.value=!1,t(y)()))},null,8,["selected-text","items"])):le("",!0),u(J,{style:{"margin-top":"20px"},columns:t(p),data:t(r),onSelectionChanged:t(C),ref_key:"mainTableRef",ref:m},null,8,["columns","data","onSelectionChanged"])])]),u(K,{ref_key:"deleteSelectedPopupRef",ref:S,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:t(P),onCancel:e[6]||(e[6]=s=>t(h)(t(S)))},{default:d(()=>[l("h2",ge,[e[15]||(e[15]=v(" Удалить сессии? ",-1)),e[16]||(e[16]=l("br",null,null,-1)),v(" "+B(t(f)),1)])]),_:1},8,["onConfirm"]),u(Q,{"table-columns":t(c),onChange:e[7]||(e[7]=s=>t(F)(s,t(n),t(m))),ref_key:"tableSettingsRef",ref:T},null,8,["table-columns"])],64))}},$e=te(ve,[["__scopeId","data-v-53c7093c"]]);export{$e as default};
