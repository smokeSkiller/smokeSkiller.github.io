import{B as Y}from"./BaseButton-BUPZcaam.js";import{B as J,c as U,u as L}from"./vue-3-slider-component-DVLLiOr3.js";import{c as d,o as C}from"./modal-DRTCzFhK.js";import{e as o,g as W,o as Z,w as g,a as e,b as q,d as z,u as N,x as X,y as A,z as K,i as k}from"./index-BWF_qH93.js";import{_ as $}from"./FilterSortDate-CPNclfv2.js";import{u as _}from"./useObjectsEditor-1kBT4oY3.js";import{u as ee}from"./useClientsEditor-Bl1EVYMt.js";const b="data:image/svg+xml,%3csvg%20width='15'%20height='15'%20viewBox='0%200%2015%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.5%200.5H2.5C1.39543%200.5%200.5%201.39543%200.5%202.5V12.5C0.5%2013.6046%201.39543%2014.5%202.5%2014.5H12.5C13.6046%2014.5%2014.5%2013.6046%2014.5%2012.5V7.75M14.5%200.5H10.5M14.5%200.5V4.5M14.5%200.5L4.5%2010.5'%20stroke='%23343434'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",h="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='16'%20height='16'%20fill='url(%23pattern0_10599_21564)'%20fill-opacity='0.75'/%3e%3cdefs%3e%3cpattern%20id='pattern0_10599_21564'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_10599_21564'%20transform='scale(0.0104167)'/%3e%3c/pattern%3e%3cimage%20id='image0_10599_21564'%20width='96'%20height='96'%20preserveAspectRatio='none'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAACl0lEQVR4nO2csWpUQRSGvyCIVcgrCFE7fQCJTeJL5BVsoggWNtuI2mkTMAr6BKZYuJ1GH0C7aIoUNqlEm6RYFPbIZWfjEiawu3dz58zc/4O/vefc/x9mZ+ayA0IIIYQQQgghhBBCCCGEEEKI+bkLvAYOgBPAMtEJ8B3YATbIkOvAZwdG2oL0CbhGJtwBfjswzRasX8AaGYz8Es23iRBWccxHByZZC9OR2x9c64jWccgbB8ZYS3qFQw4cGGMtqV6iuuPYgTHWkup3dYd1TO5IbYgpgG7JHakNMQXQLbkjtSGmALoldzR5mSHwHnjWknZDTQXASFsJ+r2vADjVSoJ+65oKgJFuJei3rqkAGOlLMGSphT6XQq2vCoCs5Y7UhpgC6JbckdoQUwDdkjtSG2IKoNky9GbLy9C6pgJgJG3EFkCTl1lJ0K+OIviv+mCsbR4oAE41DEfEj4FHF6y6ho6jC5A7UhtiCqBbckdqQ0wBdEvuSPFR/iXwo0HdAbAHvAOez1i7qAC2Gm6oZg1hH9gElimIlDvhFzOM+HvAJQok5VnQ7hQ1fgK3KZgUH+WXw5HCcIqRX7T5TQOwC1Y97cS4AWwDhyGkaZ93hEPMqfbPmfMfAn/nfOYTHGJOtXmO+fM+rw9cxiHmUIPIUrP+N/+fOZ9XAVdwijnUXqTP7dJG/hhzqLeRPg9LNB8HZltETyN9Dko0HwdmW0S9hn26nvPPUloAVU7me72qoBfps0jzvV7W0Yv0Wcycf5adAgKochz5YzYyD6Cf68if5EOmAVQ5j/xJroZz95wCqEoxf8xauF0whwD6JUw7MVad3KDYi/RWvPmTrIcL7r4l2if0Ij0dhfP84s0XQgghhBBCCCGEEEIIIYQQguT8AyZjVQ735RhUAAAAAElFTkSuQmCC'/%3e%3c/defs%3e%3c/svg%3e",te={class:"content-inner"},se={class:"box"},ne={class:"row"},le={class:"d-flex align-items-center"},oe={class:"row"},ae={class:"d-flex align-items-center"},be=Object.assign({inheritAttrs:!1},{__name:"PaymentsDetails",props:{innerWidth:Number,customClass:String},emits:["open-objects-editor","open-clients-editor","open-refund-popup"],setup(n,{expose:s,emit:i}){const a=i,l=o(null);return s({open:()=>l.value.open(),close:()=>l.value.close()}),(r,t)=>(Z(),W(J,{"inner-width":n.innerWidth,"custom-class":n.customClass,ref_key:"paymentDetailsRef",ref:l},{header:g(()=>[t[5]||(t[5]=e("h2",{class:"title"},"Детали оплаты, чек №0013",-1)),e("button",{class:"close-btn",onClick:t[0]||(t[0]=c=>N(d)(l.value))},[...t[4]||(t[4]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:g(()=>[e("div",te,[t[19]||(t[19]=e("div",{class:"top-box"},[e("p",null,[e("b",null,"60 000 ₽, 6.05.24, 08:15:05")])],-1)),e("div",se,[t[12]||(t[12]=e("div",{class:"row"},[e("p",null,"Сумма"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"60 000 ₽")]),e("button",{class:"icon copy-icon"},[e("img",{src:h})])])],-1)),t[13]||(t[13]=e("div",{class:"row row-error"},[e("p",null,"Дата и время"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"15.05.24, 12:01:05")])])],-1)),t[14]||(t[14]=e("div",{class:"row"},[e("p",null,"№ сессии"),e("p",null,[e("b",null,"1665423547316996")])],-1)),t[15]||(t[15]=e("div",{class:"row"},[e("p",null,"Тип оплаты"),e("p",null,[e("b",null,"Разовый въезд")])],-1)),t[16]||(t[16]=e("div",{class:"row"},[e("p",null,"Статус"),e("p",null,[e("b",null,"Успешно")])],-1)),e("div",ne,[t[8]||(t[8]=e("p",null,"Объект",-1)),e("div",le,[t[7]||(t[7]=e("p",null,[e("b",null,"ТЦ “Ромашка”")],-1)),e("button",{class:"icon link-icon",onClick:t[1]||(t[1]=c=>a("open-objects-editor"))},[...t[6]||(t[6]=[e("img",{src:b},null,-1)])])])]),e("div",oe,[t[11]||(t[11]=e("p",null,"Клиент",-1)),e("div",ae,[t[10]||(t[10]=e("p",null,[e("b",null,"ООО “Шишмаойл”")],-1)),e("button",{class:"icon link-icon",onClick:t[2]||(t[2]=c=>a("open-clients-editor"))},[...t[9]||(t[9]=[e("img",{src:b},null,-1)])])])]),t[17]||(t[17]=e("div",{class:"row"},[e("p",null,"ID пользователя"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"09087754")]),e("button",{class:"icon link-icon"},[e("img",{src:b})])])],-1))]),q(Y,{class:"refund-btn btn-filled",onClick:t[3]||(t[3]=c=>a("open-refund-popup"))},{default:g(()=>[...t[18]||(t[18]=[z(" Оформить возврат ",-1)])]),_:1})])]),_:1},8,["inner-width","custom-class"]))}}),S=X("payments",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"sum",title:"Сумма",headerSort:!1,formatter:function(n){return`${n.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"payment-time",title:"Время оплаты",headerSort:!1},{field:"payment-type",title:"Тип оплаты",headerSort:!1},{field:"check",title:"Чек",headerSort:!1,formatter:function(n){return`
                            <div class="check-cell">
                                <span>${n.getValue()}</span>
                                <button class="check-btn">
                                    <img src="${h}" />
                                </button>
                            </div>
                        `},cellClick:(n,s)=>{if(n.target.closest(".check-btn")){const i=s.getValue();console.log("Нажали на кнопку чека:",i)}}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(n){const s=n.getValue();return{paid:'<span class="status status-paid">Успешно</span>',refunded:'<span class="status status-canceled">Возвращён</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[s]??s}}],content:[{sum:450,id:1,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:6e4,id:2,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"canceled"},{sum:1200,id:3,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"},{sum:700,id:4,"payment-time":"15.05.24 12:01:05","payment-type":"Разовый въезд",check:"0012",status:"paid"},{sum:23e3,id:5,"payment-time":"16.05.24 08:53:42","payment-type":"Абонемент",check:"0014",status:"paid"},{sum:2100,id:6,"payment-time":"17.05.24 14:34:53","payment-type":"ParkPass",check:"0013",status:"refunded"}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function ie(){return{applyFiltersToColumns:(s,i,a)=>i.map(l=>l.field==="id"?{...l,headerClickPopup(){const r=document.createElement("div");return A(U,{onSelectSortOrder(){a(s,"id")}}).mount(r),r}}:l.field==="payment-time"?{...l,headerClickPopup(){const r=document.createElement("div");return A($,{onSelectSortOrder(){a(s,"payment-time")},onSelectCompareState(){a(s,"payment-time")},onSelectDate(){a(s,"payment-time")},onSelectDateRange(){a(s,"payment-time")}}).mount(r),r}}:l)}}function re(n){const s=S(),i=o(null),a=o([{name:"edit",label:"Массовое редактирование"}]),l=o(s.massEditor.params),r=K([{}]);return{massEditorRef:i,massEditorTabs:a,massEditorParams:l,massEditorFields:r,openMassEditor:()=>n.openMassEditor(i),addMassEditorFieldsRow:()=>n.addMassEditorFieldsRow(r)}}function ue(){const n=o(null),s=o(null),i=_(),{objectEditorRef:a}=i,l=ee(),{clientEditorRef:r}=l;return{...i,...l,savePopupRef:n,saveNotifyRef:s,saveConfirmClick:()=>{d(n.value),d(a.value),d(r.value),C(s.value),setTimeout(()=>d(s.value),3e3)}}}function we(){const n=S(),s=L(),{hasSelection:i,selectedCount:a,selectedRows:l,selectedRowsName:r,changeTableSettings:t,addResetFilterBtn:c}=s,m=o(null),p=k(()=>n.mainTable.columns),E=k(()=>n.mainTable.content),x=o(null),P=p.value.filter(u=>u.formatter!=="rowSelection").map(u=>({field:u.field,title:u.title})),f=o(null),B=o([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:M}=ie();n.mainTable.columns=M(m,p.value,c);const T=re(s),w=o([]),v=o(!1),R=o(null),I=o(null),j=o(""),V=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],H=o(!0),O=ue();const Q=()=>s.deselectAll(m),D=()=>s.deleteSelected(m,()=>d(f.value)),G=()=>C(f.value),F=u=>{s.onSelectionChanged(u,"id"),v.value&&y()},y=()=>{v.value=!0,w.value=l.value.map(u=>({name:u["payment-type"],average_sum:u.sum,total_sum:u.sum}))};return{paymentsStore:n,mainTableRef:m,tableHeader:p,tableContent:E,tableSettingsHeader:P,hasSelection:i,selectedCount:a,selectedRows:l,selectedRowsName:r,deleteSelectedPopupRef:f,tableSettingsRef:x,statusOptionsList:B,showCalculatedSummary:v,summaryItems:w,paymentDetailsRef:R,refundPopupRef:I,refundType:j,refundTypeOptions:V,refundConfirmDisabled:H,...T,...O,onSelectionChanged:F,deselectAll:Q,calculateSummaryItems:y,deleteSelected:D,changeTableSettings:t,openDeletePopup:G}}export{b as _,be as a,h as n,we as u};
