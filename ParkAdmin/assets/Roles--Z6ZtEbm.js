import{_ as j}from"./plus-icon-lxHPDhbU.js";import{_ as H,f as D,u as z,P as F,c as U,e as Z,d as V,a as q,b as G}from"./vue-3-slider-component-lab0IWlZ.js";import{B as J,_ as K}from"./BottomNotify-B40j8qxh.js";import{T as Q}from"./TableModal-DR_FmA9s.js";import{T as W}from"./CustomOpenIndicator-DDrFPNUG.js";import{B as h}from"./BaseButton-CNUrt7E6.js";import{F as X}from"./FormField-DFyU_dJ9.js";import{A as Y,B as E,e as C,i as R,_ as M,r as ee,c as w,o as $,F as O,j as te,a as i,x as A,t as le,D as oe,m as ne,b as c,w as m,u as l,y as _,d as x,z as se}from"./index-iaVJZ9tw.js";import{_ as re}from"./FilterSortSearch-SdFdygUQ.js";import{_ as ae}from"./FilterSortDate-CuMhXrGb.js";import{c as S,o as T}from"./modal-DRTCzFhK.js";const B=Y("roles",{state:()=>({mainTable:{columns:[{field:"role",title:"Роль",headerSort:!1},{field:"description",title:"Описание",headerSort:!1},{field:"users",title:"Пользователи",headerSort:!1},{field:"actions",title:"Действия",headerSort:!1,formatter:u=>`
              <div class="w-100 d-flex justify-content-end">
                <button class="delete-btn">
                  <img src="${H}" />
                </button>
              </div>
            `,cellClick:(u,f)=>{}}],content:[{role:"Администратор",description:"Полный доступ",users:2},{role:"Менеджер",description:"Доступ к CRM",users:5},{role:"Оператор",description:"Просмотр данных",users:15}]},editor:{tabs:[{name:"data",label:"Настройка ролей"}],roleName:"Роль администратора",roleSettings:[{key:"settings",label:"Настройки",checked:!1,expanded:!0,children:[{key:"devices",label:"Устройства",checked:!1,children:[{key:"devices-edit",label:"Редактирование настроек",checked:!1},{key:"devices-connect",label:"Подключение новых устройств",checked:!1},{key:"devices-zone",label:"Добавление и редактирование зон",checked:!1},{key:"delete",label:"Удаление устройств",checked:!1}]},{key:"tariffs",label:"Тарифы",checked:!1,children:[{key:"tariffs-view",label:"Просмотр тарифов",checked:!1},{key:"tariffs-edit",label:"Редактирование тарифов",checked:!1}]},{key:"users",label:"Пользователи",checked:!1,children:[{key:"users-view",label:"Просмотр тарифов",checked:!1},{key:"users-edit",label:"Редактирование тарифов",checked:!1}]},{key:"others",label:"Прочее",checked:!1,children:[{key:"others-view",label:"Просмотр тарифов",checked:!1},{key:"others-edit",label:"Редактирование тарифов",checked:!1}]},{key:"groups",label:"Группы",checked:!1,children:[{key:"groups-view",label:"Просмотр тарифов",checked:!1},{key:"groups-edit",label:"Редактирование тарифов",checked:!1}]}]},{key:"reports",label:"Отчеты",checked:!1,children:[{key:"reports-view",label:"Просмотр тарифов",checked:!1},{key:"reports-edit",label:"Редактирование тарифов",checked:!1}]},{key:"clients",label:"Клиенты",checked:!1,children:[{key:"clients-view",label:"Просмотр тарифов",checked:!1},{key:"clients-edit",label:"Редактирование тарифов",checked:!1}]}]}})});function ie(){return{applyFiltersToColumns:(f,v,d)=>v.map(r=>r.field==="name"?{...r,headerClickPopup(){const s=document.createElement("div");return E(D,{onSelectSortOrder(){d(f,"name")}}).mount(s),s}}:r.field==="geopos"?{...r,headerClickPopup(){const s=document.createElement("div");return E(D,{onSelectSortOrder(){d(f,"geopos")}}).mount(s),s}}:r.field==="country"?{...r,headerClickPopup(){const s=document.createElement("div");return E(ae,{onSelectSortOrder(){d(f,"country")},onSelectCompareState(){d(f,"country")},onSelectDate(){d(f,"country")},onSelectDateRange(){d(f,"country")}}).mount(s),s}}:r.field==="city"?{...r,headerClickPopup(){const s=document.createElement("div");return E(re,{onSelectSortOrder(){d(f,"city")},dropdownItems:[{name:"Пенза"},{name:"Мосва"},{name:"Самара"},{name:"Екатеринбург"},{name:"Кемерово"}],onSelectCheckbox(){d(f,"city")}}).mount(s),s}}:r)}}function de(){const u=B(),f=C(null),v=C(null),d=C(null),r=C(null),s=C(null),k=C(u.editor.tabs),y=R(()=>u.editor.roleName),g=R(()=>u.editor.roleSettings),n=C(!1);return u.$subscribe((b,P)=>{n.value=!0}),{roleEditorRef:f,contactsTableRef:v,savePopupRef:d,saveNotifyRef:r,deleteSinglePopupRef:s,roleEditorTabs:k,roleEditorName:y,roleEditorSettings:g,roleHasEdited:n,saveConfirmClick:()=>{S(d.value),T(r.value),setTimeout(()=>S(r.value),3e3)},cancelSaveClick:()=>{S(d.value),S(f.value)},onItemChecked:b=>{console.log("Checked:",b)}}}function ce(){const u=B(),f=z(),{addResetFilterBtn:v,changeTableSettings:d}=f,r=C(null),s=R(()=>u.mainTable.columns),k=R(()=>u.mainTable.content),y=C(null),g=s.value.filter(a=>a.formatter!=="rowSelection").map(a=>({field:a.field,title:a.title})),{applyFiltersToColumns:n}=ie();u.mainTable.columns=n(r,s.value,v);const t=de();return{rolesStore:u,mainTableRef:r,tableHeader:s,tableContent:k,tableSettingsHeader:g,tableSettingsRef:y,...t,changeTableSettings:d}}const ue={class:"custom-tree"},fe=["onClick"],pe={class:"d-flex align-items-center"},me={key:0,width:"9",height:"9",viewBox:"0 0 7 6",class:"expand-icon",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ke={class:"label"},be=["value","checked","onChange"],ve={key:0,class:"children"},ye={__name:"CustomTree",props:{data:Array,rootData:Array,modelValue:Array},emits:["update:modelValue","onSelect"],setup(u,{emit:f}){const v=u,d=f,r=n=>{n.children&&(n.expanded=!n.expanded)},s=(n,t)=>{n.children&&n.children.forEach(o=>{o.checked=t,o.children&&s(o,t)})},k=(n,t,a=null)=>{for(const o of n){if(o.key===t)return a;if(o.children){const b=k(o.children,t,o);if(b)return b}}return null},y=n=>{let t=[];for(const a of n)a.checked&&t.push({key:a.key,label:a.label}),a.children&&(t=t.concat(y(a.children)));return t},g=n=>{n.checked=!n.checked,s(n,n.checked);const t=k(v.rootData,n.key);if(t){const a=t.children.every(o=>o.checked);t.checked=a}d("onSelect",y(v.rootData))};return(n,t)=>{const a=ee("CustomTree",!0);return $(),w("div",ue,[($(!0),w(O,null,te(u.data,o=>($(),w("div",{key:o.key,class:"tree-node"},[i("div",{class:ne(["node-header",{"has-children":o.children}]),onClick:b=>r(o)},[i("div",pe,[o.children?($(),w("svg",me,[...t[3]||(t[3]=[i("path",{d:"M4.03009 5.25C3.64519 5.91667 2.68294 5.91667 2.29804 5.25L0.132973 1.5C-0.251927 0.833332 0.229199 0 0.999 0H5.32913C6.09893 0 6.58005 0.833333 6.19515 1.5L4.03009 5.25Z",fill:"#CDCDCD"},null,-1)])])):A("",!0),i("span",ke,le(o.label),1)]),i("label",{class:"checkbox",onClick:t[0]||(t[0]=oe(()=>{},["stop"]))},[i("input",{type:"checkbox",name:"check",value:o.key,checked:o.checked,onChange:b=>g(o)},null,40,be),t[4]||(t[4]=i("svg",{width:"8",height:"6",viewBox:"0 0 8 6",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M0.5 3.35714L2.6 5.5L7.5 0.5",stroke:"white","stroke-linecap":"round","stroke-linejoin":"round"})],-1))])],10,fe),o.children&&o.expanded?($(),w("div",ve,[c(a,{data:o.children,"model-value":u.modelValue,"root-data":u.rootData,"onUpdate:modelValue":t[1]||(t[1]=b=>n.$emit("update:modelValue",b)),onOnSelect:t[2]||(t[2]=b=>d("onSelect",b))},null,8,["data","model-value","root-data"])])):A("",!0)]))),128))])}}},Ce=M(ye,[["__scopeId","data-v-899849cd"]]),he={class:"page"},ge={class:"page-content"},Se={__name:"Roles",setup(u){const{rolesStore:f,mainTableRef:v,tableHeader:d,tableContent:r,tableSettingsHeader:s,deleteSinglePopupRef:k,savePopupRef:y,saveNotifyRef:g,tableSettingsRef:n,roleEditorRef:t,roleEditorTabs:a,roleEditorName:o,roleEditorSettings:b,roleHasEdited:P,saveConfirmClick:N,cancelSaveClick:I,changeTableSettings:L}=ce();return(xe,e)=>($(),w(O,null,[i("main",he,[c(W,null,{default:m(()=>[c(h,{onClick:e[0]||(e[0]=p=>l(_).push("/employers"))},{default:m(()=>[...e[14]||(e[14]=[x("Сотрудники",-1)])]),_:1}),c(h,{class:"btn-filled"},{default:m(()=>[...e[15]||(e[15]=[x("Управление ролями",-1)])]),_:1}),c(h,{onClick:e[1]||(e[1]=p=>l(_).push("/myprofile"))},{default:m(()=>[...e[16]||(e[16]=[x("Мой профиль",-1)])]),_:1}),c(h,{onClick:e[2]||(e[2]=p=>l(_).push("/general"))},{default:m(()=>[...e[17]||(e[17]=[x("Общие настройки сервиса",-1)])]),_:1})]),_:1}),i("div",ge,[c(F,null,{left:m(()=>[...e[18]||(e[18]=[])]),right:m(()=>[c(h,{class:"btn-filled add-element-btn",onClick:e[3]||(e[3]=p=>l(T)(l(t)))},{default:m(()=>[...e[19]||(e[19]=[i("img",{src:j},null,-1),x(" Добавить роль ",-1)])]),_:1}),c(h,{class:"small-btn",onClick:e[4]||(e[4]=p=>l(T)(l(n)))},{default:m(()=>[...e[20]||(e[20]=[i("img",{src:q},null,-1)])]),_:1}),c(h,{class:"small-btn"},{default:m(()=>[...e[21]||(e[21]=[i("img",{src:G},null,-1)])]),_:1})]),_:1}),c(U,{style:{"margin-top":"20px"},id:"roles-table",data:l(r),columns:l(d),onRowDblclick:e[5]||(e[5]=p=>l(T)(l(t))),ref_key:"mainTableRef",ref:v},null,8,["data","columns"])])]),c(Q,{"header-title":"Редактирование роли",tabs:l(a),"inner-width":870,"close-on-overlay-click":!1,"disabled-save-btn":!l(P),onOverlayClick:e[9]||(e[9]=p=>l(T)(l(y))),onSaveClick:l(N),onCloseClick:e[10]||(e[10]=p=>l(S)(l(t))),ref_key:"roleEditorRef",ref:t},{data:m(()=>[e[22]||(e[22]=i("h3",null,"Общая информация",-1)),c(X,{name:"role-name",modelValue:l(o),"onUpdate:modelValue":e[6]||(e[6]=p=>se(o)?o.value=p:null),label:"Название"},null,8,["modelValue"]),c(Ce,{data:l(b),"root-data":l(b),style:{"margin-top":"15px"},onOnSelect:e[7]||(e[7]=p=>console.log("Selected",p))},null,8,["data","root-data"])]),"sidebar-bottom":m(()=>[c(h,{class:"remove-object-btn",onClick:e[8]||(e[8]=p=>l(T)(l(k)))},{default:m(()=>[...e[23]||(e[23]=[i("img",{src:H},null,-1),x(" Удалить роль ",-1)])]),_:1})]),_:1},8,["tabs","disabled-save-btn","onSaveClick"]),c(Z,{"table-columns":l(s),onChange:e[11]||(e[11]=p=>l(L)(p,l(f),l(v))),ref_key:"tableSettingsRef",ref:n},null,8,["table-columns"]),c(V,{ref_key:"savePopupRef",ref:y,"confirm-text":"Сохранить","cancel-text":"Не сохранять",onCancel:l(I),onConfirm:l(N)},{default:m(()=>[...e[24]||(e[24]=[i("h2",{class:"popup-title"},"Сохранить перед выходом?",-1),i("p",{class:"popup-text"},"Без сохранения все изменения будут потеряны!",-1)])]),_:1},8,["onCancel","onConfirm"]),c(V,{ref_key:"deleteSinglePopupRef",ref:k,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:e[12]||(e[12]=p=>l(S)(l(k))),onCancel:e[13]||(e[13]=p=>l(S)(l(k)))},{default:m(()=>[...e[25]||(e[25]=[i("h2",{class:"popup-title"}," Удалить роль? ",-1)])]),_:1},512),c(J,{ref_key:"saveNotifyRef",ref:g},{default:m(()=>[...e[26]||(e[26]=[i("img",{src:K},null,-1),i("span",null,"Изменения сохранены",-1)])]),_:1},512)],64))}},He=M(Se,[["__scopeId","data-v-06d94129"]]);export{He as default};
