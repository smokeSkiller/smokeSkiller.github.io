import{_ as N,a as B,u as H,T as O,P as E,b as L,c as U,d as I,e as M,f as z,g as j,h as q}from"./FilterSortDate-B4cyY346.js";import{s as G,x,e as c,i as V,_ as J,c as K,a as s,b as o,w as p,A as Q,u as t,F as W,o as X,B as Y,d as v,t as $}from"./index-CkweRrl9.js";import{B as C}from"./BaseButton-C8-CVVQ8.js";import{o as P,c as h}from"./modal-DRTCzFhK.js";const Z=G("finances",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"date",title:"Дата",headerSort:!1,width:150},{field:"client",title:"Клиент",headerSort:!1,width:150},{field:"period",title:"Период",headerSort:!1},{field:"revenue",title:"Выручка",headerSort:!1,formatter:function(l){return`${l.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"pp",title:"% удержания",headerSort:!1},{field:"price",title:"К выплате",headerSort:!1,formatter:function(l){return`${l.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(l){const n=l.getValue();return{paid:'<span class="status status-paid">Выплачено</span>',progress:'<span class="status status-active">В процессе</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}},{field:"bank",title:"Банк",headerSort:!1}],content:[{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"progress",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"progress",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"progress",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"progress",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"progress",bank:"Точка Банк"}]}})});function ee(){return{applyFiltersToColumns:(n,d,i)=>d.map(r=>r.field==="client"?{...r,headerClickPopup(){const u=document.createElement("div");return x(N,{onSelectSortOrder(){i(n,"id")}}).mount(u),u}}:r.field==="period"?{...r,headerClickPopup(){const u=document.createElement("div");return x(B,{onSelectSortOrder(){i(n,"payment-time")},onSelectCompareState(){i(n,"payment-time")},onSelectDate(){i(n,"payment-time")},onSelectDateRange(){i(n,"payment-time")}}).mount(u),u}}:r)}}function te(){const l=Z(),n=H(),{hasSelection:d,selectedCount:i,selectedRows:r,selectedRowsName:u,changeTableSettings:b,addResetFilterBtn:T}=n,m=c(null),f=V(()=>l.mainTable.columns),k=V(()=>l.mainTable.content),_=c(null),w=f.value.filter(g=>g.formatter!=="rowSelection").map(g=>({field:g.field,title:g.title})),S=c(null),y=c([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:D}=ee();l.mainTable.columns=D(m,f.value,T);const F=c(null),R=c(null),e=c(""),a=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],A=c(!0);return{financesStore:l,mainTableRef:m,tableHeader:f,tableContent:k,tableSettingsHeader:w,hasSelection:d,selectedCount:i,selectedRows:r,selectedRowsName:u,deleteSelectedPopupRef:S,tableSettingsRef:_,statusOptionsList:y,paymentDetailsRef:F,refundPopupRef:R,refundType:e,refundTypeOptions:a,refundConfirmDisabled:A,onSelectionChanged:g=>{n.onSelectionChanged(g,"id"),showCalculatedSummary.value&&calculateSummaryItems()},deselectAll:()=>n.deselectAll(m),deleteSelected:()=>n.deleteSelected(m,()=>h(S.value)),changeTableSettings:b,openDeletePopup:()=>P(S.value)}}const ne={class:"page"},le={class:"page-content"},ae={class:"popup-title"},se={__name:"Finances",setup(l){const{financesStore:n,mainTableRef:d,tableHeader:i,tableContent:r,tableSettingsHeader:u,hasSelection:b,selectedCount:T,selectedRowsName:m,deleteSelectedPopupRef:f,tableSettingsRef:k,paymentDetailsRef:_,onSelectionChanged:w,deselectAll:S,openDeletePopup:y,deleteSelected:D,changeTableSettings:F}=te();return(R,e)=>(X(),K(W,null,[s("main",ne,[o(O,null,{default:p(()=>[o(C,{onClick:e[0]||(e[0]=a=>t(Y).push("/clients"))},{default:p(()=>[...e[7]||(e[7]=[v("Клиенты",-1)])]),_:1}),o(C,{class:"btn-filled"},{default:p(()=>[...e[8]||(e[8]=[v("Финансы",-1)])]),_:1})]),_:1}),s("div",le,[o(E,null,Q({right:p(()=>[o(C,{class:"small-btn",onClick:e[3]||(e[3]=a=>t(P)(t(k)))},{default:p(()=>[...e[11]||(e[11]=[s("img",{src:j},null,-1)])]),_:1}),o(C,{class:"small-btn"},{default:p(()=>[...e[12]||(e[12]=[s("img",{src:q},null,-1)])]),_:1})]),_:2},[t(b)==!0?{name:"left",fn:p(()=>[s("div",{class:"selected-count controller-item",onClick:e[1]||(e[1]=(...a)=>t(S)&&t(S)(...a))},[s("span",null,"Выбрано: "+$(t(T)),1),o(C,{class:"btn-filled"},{default:p(()=>[...e[9]||(e[9]=[s("img",{src:M},null,-1)])]),_:1})]),s("div",{class:"delete-row controller-item",onClick:e[2]||(e[2]=(...a)=>t(y)&&t(y)(...a))},[...e[10]||(e[10]=[s("img",{src:z},null,-1),v(" Удалить ",-1)])])]),key:"0"}:void 0]),1024),o(L,{style:{"margin-top":"20px"},columns:t(i),data:t(r),onRowDblclick:e[4]||(e[4]=a=>t(P)(t(_))),onSelectionChanged:t(w),ref_key:"mainTableRef",ref:d},null,8,["columns","data","onSelectionChanged"])])]),o(U,{ref_key:"deleteSelectedPopupRef",ref:f,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:t(D),onCancel:e[5]||(e[5]=a=>t(h)(t(f)))},{default:p(()=>[s("h2",ae,[e[13]||(e[13]=v(" Удалить сессии? ",-1)),e[14]||(e[14]=s("br",null,null,-1)),v(" "+$(t(m)),1)])]),_:1},8,["onConfirm"]),o(I,{"table-columns":t(u),onChange:e[6]||(e[6]=a=>t(F)(a,t(n),t(d))),ref_key:"tableSettingsRef",ref:k},null,8,["table-columns"])],64))}},fe=J(se,[["__scopeId","data-v-e5b1138d"]]);export{fe as default};
