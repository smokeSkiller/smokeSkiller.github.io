import{B as ae,_ as ne,a as re,b as ue,P as de,c as Y,u as me,d as pe,e as Z,f as fe}from"./vue-3-slider-component-DVLLiOr3.js";import{_ as ce}from"./plus-icon-lxHPDhbU.js";import{e as b,g as N,o as C,w as p,a as e,n as be,u as s,d as f,s as ve,b as m,t as le,x as Se,y as A,z as ge,i as _,_ as Ce,c as q,A as h,F as ee,B as ye,C as we,j as ke}from"./index-BWF_qH93.js";import{T as $e}from"./TableModal-p6TpcjEn.js";import{c as E,o as g}from"./modal-DRTCzFhK.js";import{T as xe,k as Ee}from"./CustomOpenIndicator-BQQZUi6w.js";import{_ as De,C as Re}from"./summary-icon-q8Svinap.js";import{B as D}from"./BaseButton-BUPZcaam.js";import{_ as G}from"./FormSelectField-BrAB1vmC.js";import{_ as Oe,D as Pe,a as Me}from"./useObjectsEditor-1kBT4oY3.js";import{_ as V,n as te,u as je,a as Te}from"./usePayments-D2WGjLNQ.js";import{_ as Ae}from"./close-icon-DcnZ6QH4.js";import{_ as se}from"./FilterSortDate-CPNclfv2.js";import"./useClientsEditor-Bl1EVYMt.js";const Ve="/ParkAdmin/assets/session-CFWKBI7c.png",Ne={class:"content-inner"},Ie={class:"top-box"},Fe={class:"box"},Le={class:"row"},Be={class:"d-flex align-items-center"},He={class:"row"},ze={class:"d-flex align-items-center"},Ue=Object.assign({inheritAttrs:!1},{__name:"SessionsDetails",props:{innerWidth:Number,customClass:String},emits:["open-payment-details"],setup(r,{expose:o,emit:d}){const a=b(null),n=d;return o({open:()=>a.value.open(),close:()=>a.value.close()}),(i,l)=>(C(),N(ae,{"inner-width":r.innerWidth,"custom-class":r.customClass,ref_key:"sessionDetailsRef",ref:a},{header:p(()=>[l[4]||(l[4]=e("h2",{class:"title"},"Сессия №1665423547316996",-1)),e("button",{class:"close-btn",onClick:l[0]||(l[0]=v=>s(E)(a.value))},[...l[3]||(l[3]=[e("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:p(()=>[e("div",Ne,[e("div",Ie,[e("div",{class:"img",style:be({"background-image":`url(${s(Ve)})`})},null,4),l[5]||(l[5]=e("div",{class:"content"},[e("p",null,[f(" Номер ТС: "),e("b",null,"М969ММ777")]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[f("Объект: "),e("b",null,"ТЦ “Мега”")]),e("button",{class:"icon link-icon"},[e("img",{src:V})])]),e("p",{class:"d-flex"},[e("span",{style:{width:"145px"}},[f("Клиент: "),e("b",null,"ООО Ирбис")]),e("button",{class:"icon link-icon"},[e("img",{src:V})])]),e("p",null,[f("Статус: "),e("b",null,"Оплачена")]),e("p",null,[f("Продолжительность: "),e("b",null,"02:44:26")])],-1))]),l[16]||(l[16]=e("div",{class:"box"},[e("h4",null,"Въезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1)),e("div",Fe,[l[14]||(l[14]=e("h4",null,"Оплата:",-1)),e("div",Le,[l[9]||(l[9]=e("p",null,"04.11.2025, 15:50:31, Банковская карта ****1234",-1)),e("div",Be,[l[7]||(l[7]=e("p",null,[e("b",null,"450 ₽")],-1)),l[8]||(l[8]=e("button",{class:"icon copy-icon"},[e("img",{src:te})],-1)),e("button",{class:"icon link-icon",onClick:l[1]||(l[1]=v=>n("open-payment-details"))},[...l[6]||(l[6]=[e("img",{src:V},null,-1)])])])]),l[15]||(l[15]=e("div",{class:"row row-error"},[e("p",null,"04.11.2025, 15:54:17, Банковская карта ****5990"),e("div",{class:"d-flex align-items-center"},[e("p",null,[e("b",null,"450 ₽, ошибка оплаты")])])],-1)),e("div",He,[l[13]||(l[13]=e("p",null,"04.11.2025, 16:03:14, Касса №2009",-1)),e("div",ze,[l[11]||(l[11]=e("p",null,[e("b",null,"450 ₽")],-1)),l[12]||(l[12]=e("button",{class:"icon copy-icon"},[e("img",{src:te})],-1)),e("button",{class:"icon link-icon",onClick:l[2]||(l[2]=v=>n("open-payment-details"))},[...l[10]||(l[10]=[e("img",{src:V},null,-1)])])])])]),l[17]||(l[17]=e("div",{class:"box"},[e("h4",null,"Выезд:"),e("div",{class:"d-flex justify-content-between w-100"},[e("p",null,"Дата и время"),e("p",null,[e("b",null,"14.05.24, 20:30:11")])])],-1))])]),_:1},8,["inner-width","custom-class"]))}}),We={__name:"SessionsToolbar",props:{hasSelection:Boolean,selectedCount:Number,statusOptions:Array},emits:["deselect-all","delete-selected","open-mass-editor","change-status","calculate-summary"],setup(r,{emit:o}){const d=o;return(a,n)=>(C(),N(de,null,ve({right:p(()=>[m(D,{class:"small-btn",onClick:n[5]||(n[5]=i=>d("open-settings"))},{default:p(()=>[...n[11]||(n[11]=[e("img",{src:re},null,-1)])]),_:1}),m(D,{class:"small-btn"},{default:p(()=>[...n[12]||(n[12]=[e("img",{src:ue},null,-1)])]),_:1})]),_:2},[r.hasSelection?{name:"left",fn:p(()=>[e("div",{class:"selected-count controller-item",onClick:n[0]||(n[0]=i=>d("deselect-all"))},[e("span",null,"Выбрано: "+le(r.selectedCount),1),m(D,{class:"btn-filled"},{default:p(()=>[...n[6]||(n[6]=[e("img",{src:Ae},null,-1)])]),_:1})]),e("div",{class:"delete-row controller-item",onClick:n[1]||(n[1]=i=>d("delete-selected"))},[...n[7]||(n[7]=[e("img",{src:ne},null,-1),f(" Удалить ",-1)])]),e("div",{class:"edit controller-item",onClick:n[2]||(n[2]=i=>d("open-mass-editor"))},[...n[8]||(n[8]=[e("img",{src:Oe},null,-1),f(" Редактировать ",-1)])]),m(Pe,{class:"change-status controller-item","dropdown-list":r.statusOptions,onChange:n[3]||(n[3]=i=>d("change-status",i))},{default:p(()=>[...n[9]||(n[9]=[e("img",{src:Me},null,-1),f(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"]),e("div",{class:"summary controller-item",onClick:n[4]||(n[4]=i=>d("calculate-summary"))},[...n[10]||(n[10]=[e("img",{src:De},null,-1),f(" Сумма ",-1)])])]),key:"0"}:void 0]),1024))}},oe=Se("sessions",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"object-name",title:"Объект",headerSort:!1,width:140},{field:"vehicle-number",title:"Номер ТС",headerSort:!1,width:150},{field:"enter-time",title:"Время въезда",headerSort:!1},{field:"exit-time",title:"Время выезда",headerSort:!1},{field:"duration",title:"Длительность",headerSort:!1,width:135,formatter:function(r){const o=Number(r.getValue());if(!o||isNaN(o))return"—";const d=Math.floor(o/3600),a=Math.floor(o%3600/60),n=o%60,i=l=>l.toString().padStart(2,"0");return`${i(d)}:${i(a)}:${i(n)}`}},{field:"total",title:"Сумма",headerSort:!1,width:200,formatter:function(r){return`${r.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(r){const o=r.getValue();return{paid:'<span class="status status-paid">Оплачена</span>',active:'<span class="status status-active">Активна</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[o]??o}}],content:[{id:1,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:5400,status:"paid",total:450},{id:2,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1e3,status:"active",total:600},{id:3,"object-name":"ТЦ Мега","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:1200,status:"canceled",total:500},{id:4,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:2400,status:"paid",total:450},{id:5,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1500,status:"active",total:400}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function Ke(){return{applyFiltersToColumns:(o,d,a)=>d.map(n=>n.field==="id"?{...n,headerClickPopup(){const i=document.createElement("div");return A(Y,{onSelectSortOrder(){a(o,"id")}}).mount(i),i}}:n.field==="object-name"?{...n,headerClickPopup(){const i=document.createElement("div");return A(Y,{onSelectSortOrder(){a(o,"object-name")}}).mount(i),i}}:n.field==="enter-time"?{...n,headerClickPopup(){const i=document.createElement("div");return A(se,{onSelectSortOrder(){a(o,"enter-time")},onSelectCompareState(){a(o,"enter-time")},onSelectDate(){a(o,"enter-time")},onSelectDateRange(){a(o,"enter-time")}}).mount(i),i}}:n.field==="exit-time"?{...n,headerClickPopup(){const i=document.createElement("div");return A(se,{onSelectSortOrder(){a(o,"exit-time")},onSelectCompareState(){a(o,"exit-time")},onSelectDate(){a(o,"exit-time")},onSelectDateRange(){a(o,"exit-time")}}).mount(i),i}}:n)}}function qe(r){const o=oe(),d=b(null),a=b([{name:"edit",label:"Массовое редактирование"}]),n=b(o.massEditor.params),i=ge([{}]);return{massEditorRef:d,massEditorTabs:a,massEditorParams:n,massEditorFields:i,openMassEditor:()=>r.openMassEditor(d),addMassEditorFieldsRow:()=>r.addMassEditorFieldsRow(i)}}function Ge(){const r=oe(),o=me(),{hasSelection:d,selectedCount:a,selectedRows:n,selectedRowsName:i,changeTableSettings:l,addResetFilterBtn:v}=o,S=b(null),k=_(()=>r.mainTable.columns),R=_(()=>r.mainTable.content),O=b(null),I=b(null);b(null);const $=b(null),F=k.value.filter(c=>c.formatter!=="rowSelection").map(c=>({field:c.field,title:c.title})),y=b(null),L=b([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:x}=Ke();r.mainTable.columns=x(S,k.value,v);const P=qe(o),M=b([]),w=b(!1),B=()=>o.deselectAll(S),H=()=>o.deleteSelected(S,()=>E(y.value)),z=()=>g(y.value),j=c=>{o.onSelectionChanged(c,"id"),w.value&&T()},T=()=>{w.value=!0,M.value=n.value.map(c=>({name:c["object-name"],average_length:c.duration,average_sum:c.total,total_sum:c.total}))};return{sessionsStore:r,mainTableRef:S,tableHeader:k,tableContent:R,tableSettingsHeader:F,sessionDetailsRef:O,paymentDetailsRef:I,hasSelection:d,selectedCount:a,selectedRows:n,selectedRowsName:i,deleteSelectedPopupRef:y,tableSettingsRef:$,statusOptionsList:L,showCalculatedSummary:w,summaryItems:M,...P,onSelectionChanged:j,deselectAll:B,deleteSelected:H,changeTableSettings:l,calculateSummaryItems:T,openDeletePopup:z}}const Je={class:"page"},Qe={class:"page-content"},Xe={class:"popup-title"},Ye={class:"w-100",style:{margin:"20px 0"}},Ze={class:"row refund-select"},_e={action:"#"},he=["onClick"],et={__name:"Sessions",setup(r){const{sessionsStore:o,mainTableRef:d,tableHeader:a,tableContent:n,tableSettingsHeader:i,sessionDetailsRef:l,hasSelection:v,selectedCount:S,selectedRowsName:k,deleteSelectedPopupRef:R,tableSettingsRef:O,statusOptionsList:I,showCalculatedSummary:$,summaryItems:F,massEditorRef:y,massEditorTabs:L,massEditorParams:x,massEditorFields:P,onSelectionChanged:M,deselectAll:w,openDeletePopup:B,deleteSelected:H,openMassEditor:z,addMassEditorFieldsRow:j,changeTableSettings:T,calculateSummaryItems:c}=Ge(),{paymentDetailsRef:J,refundPopupRef:U,refundType:W,refundTypeOptions:ie,refundConfirmDisabled:Q}=je();return(K,t)=>(C(),q(ee,null,[e("main",Je,[m(xe,null,{default:p(()=>[m(D,{class:"btn-filled"},{default:p(()=>[...t[18]||(t[18]=[f("Сессии",-1)])]),_:1}),m(D,{onClick:t[0]||(t[0]=u=>s(ye).push("/payments"))},{default:p(()=>[...t[19]||(t[19]=[f("Оплаты",-1)])]),_:1})]),_:1}),e("div",Qe,[s($)?h("",!0):(C(),N(We,{key:0,"has-selection":s(v),"selected-count":s(S),"status-options":s(I),onDeselectAll:s(w),onDeleteSelected:s(B),onOpenMassEditor:s(z),onChangeStatus:t[1]||(t[1]=u=>console.log("Status:",u)),onCalculateSummary:s(c),onOpenSettings:t[2]||(t[2]=u=>s(g)(s(O)))},null,8,["has-selection","selected-count","status-options","onDeselectAll","onDeleteSelected","onOpenMassEditor","onCalculateSummary"])),s($)?(C(),N(Re,{key:1,"selected-text":`${s(S)} сессии`,"title-text":"Данные по выбранным сессиям:",items:s(F),onReset:t[3]||(t[3]=u=>($.value=!1,s(w)()))},null,8,["selected-text","items"])):h("",!0),m(pe,{style:{"margin-top":"20px"},columns:s(a),data:s(n),onRowDblclick:t[4]||(t[4]=u=>s(g)(s(l))),onSelectionChanged:s(M),ref_key:"mainTableRef",ref:d},null,8,["columns","data","onSelectionChanged"])])]),m(Ue,{"inner-width":"515","custom-class":"session-details",onOpenPaymentDetails:t[5]||(t[5]=u=>s(g)(s(J))),ref_key:"sessionDetailsRef",ref:l},null,512),m(Te,{"inner-width":"515","custom-class":"payment-details",onOpenObjectsEditor:t[6]||(t[6]=u=>s(g)(K.objectEditorRef)),onOpenClientsEditor:t[7]||(t[7]=u=>s(g)(K.clientEditorRef)),onOpenRefundPopup:t[8]||(t[8]=u=>s(g)(s(U))),ref_key:"paymentDetailsRef",ref:J},null,512),m(Z,{ref_key:"deleteSelectedPopupRef",ref:R,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:s(H),onCancel:t[9]||(t[9]=u=>s(E)(s(R)))},{default:p(()=>[e("h2",Xe,[t[20]||(t[20]=f(" Удалить сессии? ",-1)),t[21]||(t[21]=e("br",null,null,-1)),f(" "+le(s(k)),1)])]),_:1},8,["onConfirm"]),m(Z,{ref_key:"refundPopupRef",ref:U,"custom-class":"refund-payment-popup","confirm-text":"Подтвердить возврат","cancel-text":"Отмена","disabled-confirm-btn":s(Q),onCancel:t[12]||(t[12]=u=>s(E)(s(U))),onConfirm:t[13]||(t[13]=u=>console.log("Возврат подтвержден"))},{default:p(()=>[t[23]||(t[23]=e("h2",{class:"popup-title"},"Возврат денежных средств",-1)),t[24]||(t[24]=e("div",{class:"row"},[e("p",null,"Сумма к возврату"),e("p",null,[e("b",null,"450 ₽")])],-1)),t[25]||(t[25]=e("div",{class:"row"},[e("p",null,"Номер чека"),e("p",null,[e("b",null,"12345")])],-1)),e("div",Ye,[e("div",Ze,[t[22]||(t[22]=e("p",null,"Причина возврата",-1)),m(s(Ee),{modelValue:s(W),"onUpdate:modelValue":[t[10]||(t[10]=u=>we(W)?W.value=u:null),t[11]||(t[11]=u=>Q.value=!1)],placeholder:"Выберите из списка",options:s(ie),clearable:!1,searchable:!1,components:{OpenIndicator:K.OpenIndicator}},null,8,["modelValue","options","components"])])]),t[26]||(t[26]=e("div",{class:"comment"},[e("label",{for:"refund-comment"},"Комментарий:"),e("textarea",{name:"refund-comment",id:"refund-comment"})],-1))]),_:1},8,["disabled-confirm-btn"]),m($e,{tabs:s(L),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:t[15]||(t[15]=u=>console.log("Changes saved!")),onCloseClick:t[16]||(t[16]=u=>s(E)(s(y))),ref_key:"massEditorRef",ref:y},{edit:p(()=>[e("form",_e,[t[29]||(t[29]=e("h3",null,"Редактирование выбранных объектов",-1)),t[30]||(t[30]=e("div",{class:"d-flex"},[e("span",{class:"fields-label"},"Параметр"),e("span",{class:"fields-label"},"До изменения"),e("span",{class:"fields-label"},"После изменения")],-1)),(C(!0),q(ee,null,ke(s(P),(u,X)=>(C(),q("div",{class:"fields-row",key:X},[m(G,{options:s(x)},null,8,["options"]),m(G,{options:s(x)},null,8,["options"]),m(G,{options:s(x)},null,8,["options"]),e("button",{type:"button",class:"delete-row",onClick:tt=>s(P).splice(X,1)},[...t[27]||(t[27]=[e("img",{src:ne},null,-1)])],8,he)]))),128)),e("button",{type:"button",class:"add-fields-btn",onClick:t[14]||(t[14]=(...u)=>s(j)&&s(j)(...u))},[...t[28]||(t[28]=[e("img",{src:ce},null,-1),f(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),m(fe,{"table-columns":s(i),onChange:t[17]||(t[17]=u=>s(T)(u,s(o),s(d))),ref_key:"tableSettingsRef",ref:O},null,8,["table-columns"])],64))}},vt=Ce(et,[["__scopeId","data-v-3a976c0f"]]);export{vt as default};
