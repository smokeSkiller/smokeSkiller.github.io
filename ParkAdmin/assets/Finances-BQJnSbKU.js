import{_ as M,a as j,u as q,T as G,P as J,b as K,c as Q,d as W,e as X,f as Y,g as Z,h as ee}from"./FilterSortDate-C6tpu_jT.js";import{C as te,_ as ne}from"./CalculatedSummary-B3cZLPfF.js";import{s as se,x as N,e as r,i as B,_ as le,c as ae,a as l,b as u,w as d,g as oe,z as ie,A as re,u as t,F as ue,o as I,B as pe,d as g,t as H}from"./index-CHysKgRS.js";import{B as k}from"./BaseButton-C7MmaeKG.js";import{o as $,c as O}from"./modal-DRTCzFhK.js";const ce=se("finances",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"date",title:"Дата",headerSort:!1,width:150},{field:"client",title:"Клиент",headerSort:!1,width:150},{field:"period",title:"Период",headerSort:!1},{field:"revenue",title:"Выручка",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"pp",title:"% удержания",headerSort:!1},{field:"price",title:"К выплате",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(a){const n=a.getValue();return{paid:'<span class="status status-paid">Выплачено</span>',processing:'<span class="status status-active">В процессе</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}},{field:"bank",title:"Банк",headerSort:!1}],content:[{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"}]}})});function de(){return{applyFiltersToColumns:(n,m,p)=>m.map(i=>i.field==="client"?{...i,headerClickPopup(){const c=document.createElement("div");return N(M,{onSelectSortOrder(){p(n,"id")}}).mount(c),c}}:i.field==="period"?{...i,headerClickPopup(){const c=document.createElement("div");return N(j,{onSelectSortOrder(){p(n,"payment-time")},onSelectCompareState(){p(n,"payment-time")},onSelectDate(){p(n,"payment-time")},onSelectDateRange(){p(n,"payment-time")}}).mount(c),c}}:i)}}function me(){const a=ce(),n=q(),{hasSelection:m,selectedCount:p,selectedRows:i,selectedRowsName:c,changeTableSettings:v,addResetFilterBtn:T}=n,f=r(null),S=B(()=>a.mainTable.columns),_=B(()=>a.mainTable.content),R=r(null),w=S.value.filter(o=>o.formatter!=="rowSelection").map(o=>({field:o.field,title:o.title})),b=r(null),P=r([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:C}=de();a.mainTable.columns=C(f,S.value,T);const x=r(null),D=r([]),y=r(!1),F=r(null),V=r(""),e=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],s=r(!0);const h=()=>n.deselectAll(f),E=()=>n.deleteSelected(f,()=>O(b.value)),L=()=>$(b.value),U=o=>{n.onSelectionChanged(o,"id"),y.value&&A()},A=()=>{y.value=!0,D.value=i.value.map(o=>{const z=o.status==="processing"?o.price:0;return{name:o.client,in_process:z,average_sum:o.revenue,total_sum:o.price}})};return{financesStore:a,mainTableRef:f,tableHeader:S,tableContent:_,tableSettingsHeader:w,hasSelection:m,selectedCount:p,selectedRows:i,selectedRowsName:c,deleteSelectedPopupRef:b,summaryItems:D,showCalculatedSummary:y,tableSettingsRef:R,statusOptionsList:P,paymentDetailsRef:x,refundPopupRef:F,refundType:V,refundTypeOptions:e,refundConfirmDisabled:s,onSelectionChanged:U,deselectAll:h,deleteSelected:E,changeTableSettings:v,openDeletePopup:L,calculateSummaryItems:A}}const fe={class:"page"},Se={class:"page-content"},ge={class:"popup-title"},ve={__name:"Finances",setup(a){const{financesStore:n,mainTableRef:m,tableHeader:p,tableContent:i,tableSettingsHeader:c,hasSelection:v,selectedCount:T,selectedRowsName:f,deleteSelectedPopupRef:S,tableSettingsRef:_,summaryItems:R,showCalculatedSummary:w,paymentDetailsRef:b,onSelectionChanged:P,deselectAll:C,openDeletePopup:x,deleteSelected:D,changeTableSettings:y,calculateSummaryItems:F}=me();return(V,e)=>(I(),ae(ue,null,[l("main",fe,[u(G,null,{default:d(()=>[u(k,{onClick:e[0]||(e[0]=s=>t(pe).push("/clients"))},{default:d(()=>[...e[9]||(e[9]=[g("Клиенты",-1)])]),_:1}),u(k,{class:"btn-filled"},{default:d(()=>[...e[10]||(e[10]=[g("Финансы",-1)])]),_:1})]),_:1}),l("div",Se,[u(J,null,re({right:d(()=>[u(k,{class:"small-btn",onClick:e[4]||(e[4]=s=>t($)(t(_)))},{default:d(()=>[...e[14]||(e[14]=[l("img",{src:Z},null,-1)])]),_:1}),u(k,{class:"small-btn"},{default:d(()=>[...e[15]||(e[15]=[l("img",{src:ee},null,-1)])]),_:1})]),_:2},[t(v)==!0?{name:"left",fn:d(()=>[l("div",{class:"selected-count controller-item",onClick:e[1]||(e[1]=(...s)=>t(C)&&t(C)(...s))},[l("span",null,"Выбрано: "+H(t(T)),1),u(k,{class:"btn-filled"},{default:d(()=>[...e[11]||(e[11]=[l("img",{src:X},null,-1)])]),_:1})]),l("div",{class:"delete-row controller-item",onClick:e[2]||(e[2]=(...s)=>t(x)&&t(x)(...s))},[...e[12]||(e[12]=[l("img",{src:Y},null,-1),g(" Удалить ",-1)])]),l("div",{class:"summary controller-item",onClick:e[3]||(e[3]=(...s)=>t(F)&&t(F)(...s))},[...e[13]||(e[13]=[l("img",{src:ne},null,-1),g(" Сумма ",-1)])])]),key:"0"}:void 0]),1024),t(w)?(I(),oe(te,{key:0,"selected-text":`${t(T)} выплаты`,"title-text":"Данные по выбранным финансам:",items:t(R),onReset:e[5]||(e[5]=s=>(w.value=!1,t(C)()))},null,8,["selected-text","items"])):ie("",!0),u(K,{style:{"margin-top":"20px"},columns:t(p),data:t(i),onRowDblclick:e[6]||(e[6]=s=>t($)(t(b))),onSelectionChanged:t(P),ref_key:"mainTableRef",ref:m},null,8,["columns","data","onSelectionChanged"])])]),u(Q,{ref_key:"deleteSelectedPopupRef",ref:S,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:t(D),onCancel:e[7]||(e[7]=s=>t(O)(t(S)))},{default:d(()=>[l("h2",ge,[e[16]||(e[16]=g(" Удалить сессии? ",-1)),e[17]||(e[17]=l("br",null,null,-1)),g(" "+H(t(f)),1)])]),_:1},8,["onConfirm"]),u(W,{"table-columns":t(c),onChange:e[8]||(e[8]=s=>t(y)(s,t(n),t(m))),ref_key:"tableSettingsRef",ref:_},null,8,["table-columns"])],64))}},_e=le(ve,[["__scopeId","data-v-47073711"]]);export{_e as default};
