import{_ as ie}from"./plus-icon-lxHPDhbU.js";import{d as Z,_ as J,u as re,P as se,a as ae,b as K,c as le,e as de,f as ue}from"./vue-3-slider-component-CbaC0ZGR.js";import{B as me,_ as pe}from"./BottomNotify-DXnomjU2.js";import{T as fe}from"./TableModal-BpXQBRhF.js";import{T as ce}from"./CustomOpenIndicator-DBeq1Fbz.js";import{B as R}from"./BaseButton-DTRLxGU6.js";import{s as ve,x as H,e as h,i as L,h as Q,E as w,G as W,H as ge,f as Ce,I as j,c as S,o as $,z as A,a as p,q as C,m as M,J as X,K as ke,k as be,d as T,C as b,t as q,L as he,l as ye,r as V,F as x,j as Y,b as g,w as c,M as N,A as Se,_ as $e,u as d,B as U}from"./index-B567c83m.js";import{_ as De}from"./FilterSortSearch-Bj1mziqT.js";import{_ as Ee}from"./FilterSortDate-D6o0gEk7.js";import{c as P,o as z}from"./modal-DRTCzFhK.js";const _=ve("roles",{state:()=>({mainTable:{columns:[{field:"role",title:"Роль",headerSort:!1},{field:"description",title:"Описание",headerSort:!1},{field:"users",title:"Пользователи",headerSort:!1},{field:"actions",title:"Действия",headerSort:!1,formatter:e=>`
              <div class="w-100 d-flex justify-content-end">
                <button class="delete-btn">
                  <img src="${Z}" />
                </button>
              </div>
            `,cellClick:(e,t)=>{}}],content:[{role:"Администратор",description:"Полный доступ",users:2},{role:"Менеджер",description:"Доступ к CRM",users:5},{role:"Оператор",description:"Просмотр данных",users:15}]},editor:{tabs:[{name:"data",label:"Настройка ролей"}],settings:[{id:1,name:"Настройки",children:[{id:2,name:"Устройства",children:[{id:3,name:"Редактирование настроек"},{id:4,name:"Подключение новых устройств"},{id:5,name:"Добавление и редактирование зон"},{id:6,name:"Удаление зон"}]},{id:7,name:"Тарифы"},{id:8,name:"Пользователи"},{id:9,name:"Прочее"},{id:10,name:"Группы"}]},{id:11,name:"Отчеты"},{id:12,name:"Клиенты"}]}})});function Re(){return{applyFiltersToColumns:(t,m,l)=>m.map(u=>u.field==="name"?{...u,headerClickPopup(){const s=document.createElement("div");return H(J,{onSelectSortOrder(){l(t,"name")}}).mount(s),s}}:u.field==="geopos"?{...u,headerClickPopup(){const s=document.createElement("div");return H(J,{onSelectSortOrder(){l(t,"geopos")}}).mount(s),s}}:u.field==="country"?{...u,headerClickPopup(){const s=document.createElement("div");return H(Ee,{onSelectSortOrder(){l(t,"country")},onSelectCompareState(){l(t,"country")},onSelectDate(){l(t,"country")},onSelectDateRange(){l(t,"country")}}).mount(s),s}}:u.field==="city"?{...u,headerClickPopup(){const s=document.createElement("div");return H(De,{onSelectSortOrder(){l(t,"city")},dropdownItems:[{name:"Пенза"},{name:"Мосва"},{name:"Самара"},{name:"Екатеринбург"},{name:"Кемерово"}],onSelectCheckbox(){l(t,"city")}}).mount(s),s}}:u)}}function Te(){const e=_(),t=h(null),m=h(null),l=h(null),u=h(null),s=h(null),n=h(e.editor.tabs),a=L(()=>e.editor.fields),i=L(()=>e.editor.settings),f=h(!1);return e.$subscribe((E,r)=>{f.value=!0}),{roleEditorRef:t,contactsTableRef:m,savePopupRef:l,saveNotifyRef:u,deleteSinglePopupRef:s,roleEditorTabs:n,roleEditorFields:a,roleEditorSettings:i,roleHasEdited:f,saveConfirmClick:()=>{P(l.value),z(u.value),setTimeout(()=>P(u.value),3e3)},cancelSaveClick:()=>{P(l.value),P(t.value)},onItemChecked:E=>{console.log("Checked:",E)}}}function Le(){const e=_(),t=re(),{addResetFilterBtn:m,changeTableSettings:l}=t,u=h(null),s=L(()=>e.mainTable.columns),n=L(()=>e.mainTable.content),a=h(null),i=s.value.filter(k=>k.formatter!=="rowSelection").map(k=>({field:k.field,title:k.title})),{applyFiltersToColumns:f}=Re();e.mainTable.columns=f(u,s.value,m);const v=Te();return{rolesStore:e,mainTableRef:u,tableHeader:s,tableContent:n,tableSettingsHeader:i,tableSettingsRef:a,...v,changeTableSettings:l}}const I="VUE3_TREE_VUE_TREE_STATE",ee=(e,t)=>{e.children&&e.children.forEach(m=>{m.checked=e.checked,t.getNode(m.id).indeterminate=!1,ee(m,t)})},F=(e,t)=>{if(!e)return;const m=t.getParent(e.id);if(!m)return;const l=t.getNode(m.id);if(m.children){const u=m.children.every(i=>i.checked),s=m.children.some(i=>!i.checked),a=m.children.some(i=>i.checked||t.getNode(i.id).indeterminate)&&s;u?(l.checked=!0,l.indeterminate=!1):a?(l.checked=!1,l.indeterminate=!0):(l.checked=!1,l.indeterminate=!1)}F(m,t)};var te=Q({inheritAttrs:!0,props:{item:{type:Object,required:!0},isCheckable:{type:Boolean},canRename:{type:Boolean},checkboxStyle:{type:String},lazyLoad:{type:Boolean},hideGuideLines:{type:Boolean}},emits:["on-rename","onContextMenu"],setup(e,{emit:t,attrs:m}){const l=h(),u=L(()=>m.parent),s=W(I),n=()=>{l.value&&e.item.checked!==void 0&&(l.value.checked=e.item.checked)};Ce(()=>{var r;s.trackNode(e.item,u.value),e.item.checked?j(()=>{n(),F(e.item,s)}):((r=u.value)===null||r===void 0?void 0:r.checked)!==void 0&&(e.item.checked=u.value.checked)});const a=L(()=>{var r={"selected-tree-item":!e.isCheckable&&e.item.selected};return e.item.styles&&e.item.styles.forEach(y=>r[y]=!0),r}),i=()=>{l.value&&(e.item.checked=l.value.checked,e.item.indeterminate=!1,F(e.item,s),ee(e.item,s),s.emitItemCheckedChange())};w(()=>e.item.indeterminate,()=>{l.value&&e.item.indeterminate!==void 0&&(l.value.indeterminate=e.item.indeterminate)}),w(()=>e.item.checked,()=>j(n)),w(()=>e.item.expanded,()=>E(!1)),w(()=>{var r;return(r=e.item.children)===null||r===void 0?void 0:r.length},()=>{var r;return(r=e.item.children)===null||r===void 0?void 0:r.forEach(y=>s?.trackNode(y,e.item))});const f=h(!1),v=h(),k=()=>{e.canRename&&(f.value=!0,j().then(()=>{var r;return(r=v.value)===null||r===void 0?void 0:r.focus()}))},O=()=>{f&&t("on-rename",e.item)},E=(r=!0)=>{r&&(e.item.expanded=!e.item.expanded),e.item.expanded?s?.emitItemExpanded(e.item):s?.emitItemCollapsed(e.item)};return{styles:a,checkbox:l,parent:u,treeState:s,isRenaming:f,renameBox:v,updateCheckState:i,beginRenaming:k,finishRenaming:O,toggleExpand:E}}});const Ne={key:0,class:"guide-line"},Pe={key:0,class:"tree-item__checkbox-area"},ze=["disabled"],Me={class:"d-flex"},Oe={class:"tiny_horizontal_margin"},Be={class:"tiny_horizontal_margin"},Ge={key:0,for:"checkbox",class:"pointer"},we={class:"tiny_horizontal_margin"},Ae={class:"tiny_horizontal_margin"};function He(e,t,m,l,u,s){return $(),S("div",{class:"d-flex align-items-center",onContextmenu:t[8]||(t[8]=b(n=>e.$emit("onContextMenu",{item:e.item,event:n}),["prevent"]))},[e.parent!=null&&!e.hideGuideLines?($(),S("div",Ne)):A("",!0),(e.lazyLoad||e.item.children&&e.item.children.length>0)&&(e.item.collapsible==null||e.item.collapsible==!0)?($(),S("div",{key:1,onClick:t[0]||(t[0]=n=>e.toggleExpand())},[C(e.$slots,"expander",X(ke(e.item)),()=>[p("span",{class:M(["chevron-right",{"rotate-90":e.item.expanded}])},null,2)])])):A("",!0),p("div",{class:M(["pointer tree-item",e.styles]),style:{width:"100%"}},[e.isRenaming?be(($(),S("input",{key:1,ref:"rename-box","onUpdate:modelValue":t[5]||(t[5]=n=>e.item.name=n),onKeyup:t[6]||(t[6]=ye((...n)=>e.finishRenaming&&e.finishRenaming(...n),["enter"])),onBlur:t[7]||(t[7]=(...n)=>e.finishRenaming&&e.finishRenaming(...n))},null,544)),[[he,e.item.name]]):($(),S("div",{key:0,onDblclick:t[4]||(t[4]=(...n)=>e.beginRenaming&&e.beginRenaming(...n))},[e.isCheckable?($(),S("div",Pe,[p("input",{onContextmenu:t[1]||(t[1]=b(()=>{},["prevent"])),onChange:t[2]||(t[2]=(...n)=>e.updateCheckState&&e.updateCheckState(...n)),type:"checkbox",ref:"checkbox",disabled:e.item.disabled,class:M(e.checkboxStyle)},null,42,ze),p("div",Me,[p("div",Oe,[C(e.$slots,"icon")]),p("div",Be,[C(e.$slots,"prepend")])]),C(e.$slots,"name",{},()=>[e.isRenaming?A("",!0):($(),S("label",Ge,q(e.item.name),1))]),t[9]||(t[9]=T("   ")),C(e.$slots,"append")])):($(),S("div",{key:1,class:"d-flex",onClick:t[3]||(t[3]=n=>{var a;return(a=e.treeState)===null||a===void 0?void 0:a.emitItemSelected(e.item)})},[p("div",we,[C(e.$slots,"icon")]),p("div",Ae,[C(e.$slots,"prepend")]),C(e.$slots,"name",{},()=>[p("span",null,q(e.item.name),1)]),t[10]||(t[10]=T("   ")),C(e.$slots,"append")]))],32))],2)],32)}te.render=He;function je(){const e=n=>{const a=n.currentTarget;a&&a.classList.add("tree-item__drag-over")},t=(n,a)=>{if(!a)return;const i=n.currentTarget;i&&i.classList.add("root__drag-over")},m=(n,a)=>{if(!a)return;const i=n.currentTarget;i&&i.classList.remove("root__drag-over")},l=n=>{const a=n.currentTarget;a&&a.classList.remove("tree-item__drag-over")};return{addHoverClass:e,removeHoverClass:l,onDragNode:(n,a)=>{n.disableDragAndDrop||a.dataTransfer&&a.dataTransfer.setData("text/plain",JSON.stringify(n))},onDropNode:(n,a,i,f)=>{if(a.dataTransfer){l(a);const v=JSON.parse(a.dataTransfer.getData("text/plain"));if(!i||n&&v.id===n.id||v.disableDragAndDrop)return;i(v,n).then(k=>{k&&(f.detach(v.id),n&&!n.children&&(n.children=[]),n?n.children.push(v):f.attach(v))})}},addRootHoverClass:t,removeRootHoverClass:m}}function Ue(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(Number.parseFloat(e)^crypto.getRandomValues(new Uint8Array(1))[0]&15>>Number.parseFloat(e)/4).toString(16))}function Ie(e,t,m,l,u){const s={},n={},a=r=>s[r],i=(r,y)=>{r.id||(r.id=Ue()),n[r.id]=r,s[r.id]=y};return{getNode:r=>n[r],getParent:a,trackNode:i,detach:r=>{const y=s[r];if(y==null)e.value=e.value.filter(G=>G.id!=r);else{var B;y.children=(B=y.children)===null||B===void 0?void 0:B.filter(G=>G.id!=r)}delete s[r]},emitItemCheckedChange:()=>m(Object.values(n).filter(r=>r.checked&&!r.disabled)),emitItemSelected:r=>{r.disabled!==!0&&(t(r),Object.values(n).forEach(y=>y.selected=!1),r.selected=!0)},emitItemExpanded:l,emitItemCollapsed:u,attach:r=>{e.value.push(r),i(r,void 0)}}}var ne=Q({name:"tree-view",props:{items:{type:Array,required:!0,default:()=>[]},isCheckable:{type:Boolean},hideGuideLines:{type:Boolean,default:!1},onDropValidator:{type:Function},treeState:{type:Object},checkboxStyle:{type:String},lazyLoad:{type:Boolean}},components:{"treeview-item":te},emits:["onContextMenu","onSelect","onCheck","onExpand","onCollapse"],setup(e,{emit:t,attrs:m}){const l=h([]);w(()=>e.items,()=>l.value=e.items,{immediate:!0});const u=L(()=>m.parent),s=L(()=>l.value.map(a=>a)),n=h();return n.value=W(I,void 0),n.value||(n.value=Ie(l,a=>t("onSelect",a),a=>t("onCheck",a),a=>t("onExpand",a),a=>t("onCollapse",a)),ge(I,n.value)),{...je(),parent:u,internalItems:s,treeState:n}}});const Fe={class:"vue3-tree-vue"},Je=["draggable"],Ke=["id"],qe={style:{"list-style":"none"}};function Ve(e,t,m,l,u,s){const n=V("treeview-item"),a=V("tree-view");return $(),S("div",Fe,[p("ul",{id:"explorer",class:M(["explorer tree-item-node-parent",{"no-guide":e.hideGuideLines}]),draggable:e.onDropValidator!=null,onDragover:[t[3]||(t[3]=b(()=>{},["stop","prevent"])),t[5]||(t[5]=b(i=>e.addRootHoverClass(i,e.parent==null),["stop"]))],onDragenter:t[4]||(t[4]=b(()=>{},["stop","prevent"])),onDragleave:t[6]||(t[6]=b(i=>e.removeRootHoverClass(i,e.parent==null),["stop"])),onDrop:t[7]||(t[7]=b(i=>{e.onDropNode(void 0,i,e.onDropValidator,e.treeState),e.removeRootHoverClass(i,e.parent==null)},["prevent","stop"]))},[($(!0),S(x,null,Y(e.internalItems,i=>($(),S("li",{key:i.id,id:i.id,class:M(["tree-item-node",{"tree-item-node-checkable":e.isCheckable}])},[g(n,{class:"pointer tree-view-item",item:i,parent:e.parent,hideGuideLines:e.hideGuideLines,onDragover:[t[0]||(t[0]=b(()=>{},["stop","prevent"])),b(e.addHoverClass,["stop"])],onDragenter:t[1]||(t[1]=b(()=>{},["stop","prevent"])),draggable:e.onDropValidator!=null,onDragstart:b(f=>e.onDragNode(i,f),["stop"]),onDragleave:b(e.removeHoverClass,["stop"]),onDrop:b(f=>e.onDropNode(i,f,e.onDropValidator,e.treeState),["prevent","stop"]),checkboxStyle:e.checkboxStyle,isCheckable:e.isCheckable,treeState:e.treeState,lazyLoad:e.lazyLoad,onContextmenu:b(f=>e.$emit("onContextMenu",{item:i,event:f}),["prevent"])},{icon:c(()=>[C(e.$slots,"item-prepend-icon",N({ref_for:!0},i))]),prepend:c(()=>[C(e.$slots,"item-prepend",N({ref_for:!0},i))]),expander:c(()=>[C(e.$slots,"item-expander",N({ref_for:!0},i))]),name:c(()=>[C(e.$slots,"item-name",N({ref_for:!0},i))]),append:c(()=>[C(e.$slots,"item-append",N({ref_for:!0},i))]),_:2},1032,["item","parent","hideGuideLines","draggable","onDragstart","onDragleave","onDrop","onDragover","checkboxStyle","isCheckable","treeState","lazyLoad","onContextmenu"]),i.children&&i.children.length>0?($(),S("div",{key:0,class:M(["node-child",{nested:e.parent!=null,root:e.parent==null,hide:!i.expanded,"hide-guidelines":e.hideGuideLines}])},[g(a,{items:i.children,hideGuideLines:e.hideGuideLines,isNested:!0,onDropValidator:e.onDropValidator,lazyLoad:e.lazyLoad,checkboxStyle:e.checkboxStyle,parent:i,isCheckable:e.isCheckable,onOnContextMenu:t[2]||(t[2]=f=>e.$emit("onContextMenu",f))},Se({_:2},[Y(e.$slots,(f,v)=>({name:v,fn:c(k=>[C(e.$slots,v,N({ref_for:!0},k))])}))]),1032,["items","hideGuideLines","onDropValidator","lazyLoad","checkboxStyle","parent","isCheckable"])],2)):A("",!0)],10,Ke))),128))],42,Je),p("li",qe,[e.parent?C(e.$slots,"child-append",X(N({key:0},e.parent))):A("",!0)])])}ne.render=Ve;var Ye=(()=>{const e=ne;return e.install=t=>{t.component("vue3-tree-vue",e)},e})();const Ze={class:"page"},Qe={class:"page-content"},We={__name:"Roles",setup(e){const{rolesStore:t,mainTableRef:m,tableHeader:l,tableContent:u,tableSettingsHeader:s,deleteSinglePopupRef:n,savePopupRef:a,saveNotifyRef:i,tableSettingsRef:f,roleEditorRef:v,roleEditorTabs:k,roleEditorSettings:O,roleHasEdited:E,saveConfirmClick:r,cancelSaveClick:y,changeTableSettings:B,onItemChecked:G}=Le();return(oe,o)=>($(),S(x,null,[p("main",Ze,[g(ce,null,{default:c(()=>[g(R,{onClick:o[0]||(o[0]=D=>d(U).push("/employers"))},{default:c(()=>[...o[12]||(o[12]=[T("Сотрудники",-1)])]),_:1}),g(R,{class:"btn-filled"},{default:c(()=>[...o[13]||(o[13]=[T("Управление ролями",-1)])]),_:1}),g(R,{onClick:o[1]||(o[1]=D=>d(U).push("/myprofile"))},{default:c(()=>[...o[14]||(o[14]=[T("Мой профиль",-1)])]),_:1}),g(R,{onClick:o[2]||(o[2]=D=>d(U).push("/general"))},{default:c(()=>[...o[15]||(o[15]=[T("Общие настройки сервиса",-1)])]),_:1})]),_:1}),p("div",Qe,[g(se,null,{left:c(()=>[...o[16]||(o[16]=[])]),right:c(()=>[g(R,{class:"btn-filled add-element-btn",onClick:o[3]||(o[3]=D=>d(z)(d(v)))},{default:c(()=>[...o[17]||(o[17]=[p("img",{src:ie},null,-1),T(" Добавить роль ",-1)])]),_:1}),g(R,{class:"small-btn",onClick:o[4]||(o[4]=D=>d(z)(d(f)))},{default:c(()=>[...o[18]||(o[18]=[p("img",{src:de},null,-1)])]),_:1}),g(R,{class:"small-btn"},{default:c(()=>[...o[19]||(o[19]=[p("img",{src:ue},null,-1)])]),_:1})]),_:1}),g(ae,{style:{"margin-top":"20px"},id:"roles-table",data:d(u),columns:d(l),onRowDblclick:o[5]||(o[5]=D=>d(z)(d(v))),onSelectionChanged:oe.onSelectionChanged,ref_key:"mainTableRef",ref:m},null,8,["data","columns","onSelectionChanged"])])]),g(fe,{"header-title":"Редактирование роли",tabs:d(k),"inner-width":870,"close-on-overlay-click":!1,"disabled-save-btn":!d(E),onOverlayClick:o[7]||(o[7]=D=>d(z)(d(a))),onSaveClick:d(r),onCloseClick:o[8]||(o[8]=D=>d(P)(d(v))),ref_key:"roleEditorRef",ref:v},{data:c(()=>[o[21]||(o[21]=p("h3",null,"Общая информация",-1)),g(d(Ye),{class:"role-settings",items:d(O),isCheckable:!0,hideGuideLines:!1,onOnCheck:d(G)},{"item-expander":c(()=>[...o[20]||(o[20]=[p("svg",{width:"9",height:"9",viewBox:"0 0 7 6",class:"chevron",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M4.03009 5.25C3.64519 5.91667 2.68294 5.91667 2.29804 5.25L0.132973 1.5C-0.251927 0.833332 0.229199 0 0.999 0H5.32913C6.09893 0 6.58005 0.833333 6.19515 1.5L4.03009 5.25Z",fill:"#CDCDCD"})],-1)])]),_:1},8,["items","onOnCheck"])]),"sidebar-bottom":c(()=>[g(R,{class:"remove-object-btn",onClick:o[6]||(o[6]=D=>d(z)(d(n)))},{default:c(()=>[...o[22]||(o[22]=[p("img",{src:Z},null,-1),T(" Удалить роль ",-1)])]),_:1})]),_:1},8,["tabs","disabled-save-btn","onSaveClick"]),g(K,{ref_key:"savePopupRef",ref:a,"confirm-text":"Сохранить","cancel-text":"Не сохранять",onCancel:d(y),onConfirm:d(r)},{default:c(()=>[...o[23]||(o[23]=[p("h2",{class:"popup-title"},"Сохранить перед выходом?",-1),p("p",{class:"popup-text"},"Без сохранения все изменения будут потеряны!",-1)])]),_:1},8,["onCancel","onConfirm"]),g(K,{ref_key:"deleteSinglePopupRef",ref:n,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:o[9]||(o[9]=D=>d(P)(d(n))),onCancel:o[10]||(o[10]=D=>d(P)(d(n)))},{default:c(()=>[...o[24]||(o[24]=[p("h2",{class:"popup-title"}," Удалить роль? ",-1)])]),_:1},512),g(me,{ref_key:"saveNotifyRef",ref:i},{default:c(()=>[...o[25]||(o[25]=[p("img",{src:pe},null,-1),p("span",null,"Изменения сохранены",-1)])]),_:1},512),g(le,{"table-columns":d(s),onChange:o[11]||(o[11]=D=>d(B)(D,d(t),d(m))),ref_key:"tableSettingsRef",ref:f},null,8,["table-columns"])],64))}},at=$e(We,[["__scopeId","data-v-6888dacc"]]);export{at as default};
