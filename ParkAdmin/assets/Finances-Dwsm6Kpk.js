import{_ as z}from"./close-icon-DcnZ6QH4.js";import{c as j,u as q,P as G,d as J,e as K,f as Q,_ as W,a as X,b as Y}from"./vue-3-slider-component-DVLLiOr3.js";import{C as Z,_ as ee}from"./summary-icon-q8Svinap.js";import{x as te,y as N,e as r,i as B,_ as ne,c as se,a as l,b as u,w as d,g as le,A as ae,s as oe,u as t,F as ie,o as I,B as re,d as g,t as H}from"./index-BWF_qH93.js";import{B as k}from"./BaseButton-BUPZcaam.js";import{o as P,c as O}from"./modal-DRTCzFhK.js";import{T as ue}from"./CustomOpenIndicator-BQQZUi6w.js";import{_ as pe}from"./FilterSortDate-CPNclfv2.js";const ce=te("finances",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"date",title:"Дата",headerSort:!1,width:150},{field:"client",title:"Клиент",headerSort:!1,width:150},{field:"period",title:"Период",headerSort:!1},{field:"revenue",title:"Выручка",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"pp",title:"% удержания",headerSort:!1},{field:"price",title:"К выплате",headerSort:!1,formatter:function(a){return`${a.getValue().toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/,/g,".")} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(a){const n=a.getValue();return{paid:'<span class="status status-paid">Выплачено</span>',processing:'<span class="status status-active">В процессе</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[n]??n}},{field:"bank",title:"Банк",headerSort:!1}],content:[{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"},{date:"15.05.2024",client:"ООО “ШишмаОил",period:"1-15 мая",revenue:15e4,pp:15,price:127500,status:"paid",bank:"Сбербанк"},{date:"15.05.2024",client:"ИП Васильев",period:"1-15 мая",revenue:89e3,pp:10,price:78650,status:"processing",bank:"Точка Банк"}]}})});function de(){return{applyFiltersToColumns:(n,m,p)=>m.map(i=>i.field==="client"?{...i,headerClickPopup(){const c=document.createElement("div");return N(j,{onSelectSortOrder(){p(n,"id")}}).mount(c),c}}:i.field==="period"?{...i,headerClickPopup(){const c=document.createElement("div");return N(pe,{onSelectSortOrder(){p(n,"payment-time")},onSelectCompareState(){p(n,"payment-time")},onSelectDate(){p(n,"payment-time")},onSelectDateRange(){p(n,"payment-time")}}).mount(c),c}}:i)}}function me(){const a=ce(),n=q(),{hasSelection:m,selectedCount:p,selectedRows:i,selectedRowsName:c,changeTableSettings:v,addResetFilterBtn:_}=n,f=r(null),S=B(()=>a.mainTable.columns),T=B(()=>a.mainTable.content),F=r(null),w=S.value.filter(o=>o.formatter!=="rowSelection").map(o=>({field:o.field,title:o.title})),b=r(null),R=r([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:C}=de();a.mainTable.columns=C(f,S.value,_);const x=r(null),$=r([]),y=r(!1),D=r(null),V=r(""),e=[{value:"tech-issue",label:"Техническая ошибка"},{value:"payment-issue",label:"Ошибка при оплате"},{value:"another-issue",label:"Другое"}],s=r(!0);const E=()=>n.deselectAll(f),L=()=>n.deleteSelected(f,()=>O(b.value)),U=()=>P(b.value),h=o=>{n.onSelectionChanged(o,"id"),y.value&&A()},A=()=>{y.value=!0,$.value=i.value.map(o=>{const M=o.status==="processing"?o.price:0;return{name:o.client,in_process:M,average_sum:o.revenue,total_sum:o.price}})};return{financesStore:a,mainTableRef:f,tableHeader:S,tableContent:T,tableSettingsHeader:w,hasSelection:m,selectedCount:p,selectedRows:i,selectedRowsName:c,deleteSelectedPopupRef:b,summaryItems:$,showCalculatedSummary:y,tableSettingsRef:F,statusOptionsList:R,paymentDetailsRef:x,refundPopupRef:D,refundType:V,refundTypeOptions:e,refundConfirmDisabled:s,onSelectionChanged:h,deselectAll:E,deleteSelected:L,changeTableSettings:v,openDeletePopup:U,calculateSummaryItems:A}}const fe={class:"page"},Se={class:"page-content"},ge={class:"popup-title"},ve={__name:"Finances",setup(a){const{financesStore:n,mainTableRef:m,tableHeader:p,tableContent:i,tableSettingsHeader:c,hasSelection:v,selectedCount:_,selectedRowsName:f,deleteSelectedPopupRef:S,tableSettingsRef:T,summaryItems:F,showCalculatedSummary:w,paymentDetailsRef:b,onSelectionChanged:R,deselectAll:C,openDeletePopup:x,deleteSelected:$,changeTableSettings:y,calculateSummaryItems:D}=me();return(V,e)=>(I(),se(ie,null,[l("main",fe,[u(ue,null,{default:d(()=>[u(k,{onClick:e[0]||(e[0]=s=>t(re).push("/clients"))},{default:d(()=>[...e[9]||(e[9]=[g("Клиенты",-1)])]),_:1}),u(k,{class:"btn-filled"},{default:d(()=>[...e[10]||(e[10]=[g("Финансы",-1)])]),_:1})]),_:1}),l("div",Se,[u(G,null,oe({right:d(()=>[u(k,{class:"small-btn",onClick:e[4]||(e[4]=s=>t(P)(t(T)))},{default:d(()=>[...e[14]||(e[14]=[l("img",{src:X},null,-1)])]),_:1}),u(k,{class:"small-btn"},{default:d(()=>[...e[15]||(e[15]=[l("img",{src:Y},null,-1)])]),_:1})]),_:2},[t(v)==!0?{name:"left",fn:d(()=>[l("div",{class:"selected-count controller-item",onClick:e[1]||(e[1]=(...s)=>t(C)&&t(C)(...s))},[l("span",null,"Выбрано: "+H(t(_)),1),u(k,{class:"btn-filled"},{default:d(()=>[...e[11]||(e[11]=[l("img",{src:z},null,-1)])]),_:1})]),l("div",{class:"delete-row controller-item",onClick:e[2]||(e[2]=(...s)=>t(x)&&t(x)(...s))},[...e[12]||(e[12]=[l("img",{src:W},null,-1),g(" Удалить ",-1)])]),l("div",{class:"summary controller-item",onClick:e[3]||(e[3]=(...s)=>t(D)&&t(D)(...s))},[...e[13]||(e[13]=[l("img",{src:ee},null,-1),g(" Сумма ",-1)])])]),key:"0"}:void 0]),1024),t(w)?(I(),le(Z,{key:0,"selected-text":`${t(_)} выплаты`,"title-text":"Данные по выбранным финансам:",items:t(F),onReset:e[5]||(e[5]=s=>(w.value=!1,t(C)()))},null,8,["selected-text","items"])):ae("",!0),u(J,{style:{"margin-top":"20px"},columns:t(p),data:t(i),onRowDblclick:e[6]||(e[6]=s=>t(P)(t(b))),onSelectionChanged:t(R),ref_key:"mainTableRef",ref:m},null,8,["columns","data","onSelectionChanged"])])]),u(K,{ref_key:"deleteSelectedPopupRef",ref:S,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:t($),onCancel:e[7]||(e[7]=s=>t(O)(t(S)))},{default:d(()=>[l("h2",ge,[e[16]||(e[16]=g(" Удалить сессии? ",-1)),e[17]||(e[17]=l("br",null,null,-1)),g(" "+H(t(f)),1)])]),_:1},8,["onConfirm"]),u(Q,{"table-columns":t(c),onChange:e[8]||(e[8]=s=>t(y)(s,t(n),t(m))),ref_key:"tableSettingsRef",ref:T},null,8,["table-columns"])],64))}},$e=ne(ve,[["__scopeId","data-v-03c5e8c8"]]);export{$e as default};
