import{_ as z,a as U,u as Z,T as ee,P as te,C as se,b as le,B as ne,c as oe,d as ae,e as ie,f as re,g as q,h as de,D as ue,i as me,j as ce,k as pe,l as fe,F as H,m as be}from"./FilterSortDate-BrZCFu53.js";import{o as L,c as O}from"./modal-DRTCzFhK.js";import{s as ve,x as T,e as b,y as Se,i as G,_ as ge,c as _,a as t,b as d,w as c,g as J,z as K,u as s,A as we,F as Q,o as j,d as u,t as W,j as Ce}from"./index-CPlaCTx-.js";import{B as $}from"./BaseButton-DAqwIay0.js";const X="data:image/svg+xml,%3csvg%20width='15'%20height='15'%20viewBox='0%200%2015%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.5%200.5H2.5C1.39543%200.5%200.5%201.39543%200.5%202.5V12.5C0.5%2013.6046%201.39543%2014.5%202.5%2014.5H12.5C13.6046%2014.5%2014.5%2013.6046%2014.5%2012.5V7.75M14.5%200.5H10.5M14.5%200.5V4.5M14.5%200.5L4.5%2010.5'%20stroke='%23343434'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Y=ve("sessions",{state:()=>({mainTable:{columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,width:30},{field:"id",title:"№ Сессии",headerSort:!1,width:150},{field:"object-name",title:"Объект",headerSort:!1,width:140},{field:"vehicle-number",title:"Номер ТС",headerSort:!1,width:150},{field:"enter-time",title:"Время въезда",headerSort:!1,width:145},{field:"exit-time",title:"Время выезда",headerSort:!1,width:145},{field:"duration",title:"Длительность",headerSort:!1,width:135,formatter:function(r){const l=Number(r.getValue());if(!l||isNaN(l))return"—";const p=Math.floor(l/3600),a=Math.floor(l%3600/60),i=l%60,n=f=>f.toString().padStart(2,"0");return`${n(p)}:${n(a)}:${n(i)}`}},{field:"total",title:"Сумма",headerSort:!1,width:200,formatter:function(r){return`${r.getValue()} ₽`}},{field:"status",title:"Статус",headerSort:!1,width:160,formatter:function(r){const l=r.getValue();return{paid:'<span class="status status-paid">Оплачена</span>',active:'<span class="status status-active">Активна</span>',canceled:'<span class="status status-canceled">Отменена</span>'}[l]??l}}],content:[{id:1,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:5400,status:"paid",total:450},{id:2,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1e3,status:"active",total:600},{id:3,"object-name":"ТЦ Мега","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:1200,status:"canceled",total:500},{id:4,"object-name":"ТЦ Ромашка","vehicle-number":"У 888 ХХ 777","enter-time":"15.05.24 12:01:05","exit-time":"15.05.24 14:45:31",duration:2400,status:"paid",total:450},{id:5,"object-name":"БЦ Оазис","vehicle-number":"М 969 ММ 777","enter-time":"16.05.24 08:15:00","exit-time":"-",duration:1500,status:"active",total:400}]},massEditor:{params:[{label:"№ Сессии",value:"session-id"},{label:"Объект",value:"object-name"},{label:"Номер ТС",value:"vehicle-number"},{label:"Время въезда",value:"enter-time"},{label:"Время выезда",value:"exit-time"},{label:"Длительность",value:"duration"},{label:"Сумма",value:"total"},{label:"Статус",value:"status"}]}})});function ke(){return{applyFiltersToColumns:(l,p,a)=>p.map(i=>i.field==="session-id"?{...i,headerClickPopup(){const n=document.createElement("div");return T(z,{onSelectSortOrder(){a(l,"session-id")}}).mount(n),n}}:i.field==="object-name"?{...i,headerClickPopup(){const n=document.createElement("div");return T(z,{onSelectSortOrder(){a(l,"object-name")}}).mount(n),n}}:i.field==="enter-time"?{...i,headerClickPopup(){const n=document.createElement("div");return T(U,{onSelectSortOrder(){a(l,"enter-time")},onSelectCompareState(){a(l,"enter-time")},onSelectDate(){a(l,"enter-time")},onSelectDateRange(){a(l,"enter-time")}}).mount(n),n}}:i.field==="exit-time"?{...i,headerClickPopup(){const n=document.createElement("div");return T(U,{onSelectSortOrder(){a(l,"exit-time")},onSelectCompareState(){a(l,"exit-time")},onSelectDate(){a(l,"exit-time")},onSelectDateRange(){a(l,"exit-time")}}).mount(n),n}}:i)}}function xe(r){const l=Y(),p=b(null),a=b([{name:"edit",label:"Массовое редактирование"}]),i=b(l.massEditor.params),n=Se([{}]);return{massEditorRef:p,massEditorTabs:a,massEditorParams:i,massEditorFields:n,openMassEditor:()=>r.openMassEditor(p),addMassEditorFieldsRow:()=>r.addMassEditorFieldsRow(n)}}function ye(){const r=Y(),l=Z(),{hasSelection:p,selectedCount:a,selectedRows:i,selectedRowsName:n,changeTableSettings:f,addResetFilterBtn:g}=l,v=b(null),S=G(()=>r.mainTable.columns),h=G(()=>r.mainTable.content),V=b(null),w=S.value.filter(m=>m.formatter!=="rowSelection").map(m=>({field:m.field,title:m.title})),C=b(null),N=b([{value:"active",title:"Действующий"},{value:"stopped",title:"Приостановлен"},{value:"disabled",title:"Неактивный"},{value:"status-1",title:"Статус 1"},{value:"status-2",title:"Статус 2"}]),{applyFiltersToColumns:R}=ke();r.mainTable.columns=R(v,S.value,g);const k=xe(l),x=b([]),y=b(!1),E=()=>l.deselectAll(v),P=()=>l.deleteSelected(v,()=>O(C.value)),F=()=>L(C.value),D=m=>{l.onSelectionChanged(m,"id"),y.value&&M()},M=()=>{y.value=!0,x.value=i.value.map(m=>({name:m["object-name"],average_length:m.duration,average_sum:m.total,total_sum:m.total}))};return{sessionsStore:r,mainTableRef:v,tableHeader:S,tableContent:h,tableSettingsHeader:w,hasSelection:p,selectedCount:a,selectedRows:i,selectedRowsName:n,deleteSelectedPopupRef:C,tableSettingsRef:V,statusOptionsList:N,showCalculatedSummary:y,summaryItems:x,...k,onSelectionChanged:D,deselectAll:E,deleteSelected:P,changeTableSettings:f,calculateSummaryItems:M,openDeletePopup:F}}const Ee={class:"page"},Me={class:"page-content"},je={class:"popup-title"},$e={action:"#"},he=["onClick"],Pe={__name:"Sessions",setup(r){const{sessionsStore:l,mainTableRef:p,tableHeader:a,tableContent:i,tableSettingsHeader:n,hasSelection:f,selectedCount:g,selectedRowsName:v,deleteSelectedPopupRef:S,tableSettingsRef:h,statusOptionsList:V,showCalculatedSummary:w,summaryItems:C,massEditorRef:N,massEditorTabs:R,massEditorParams:k,massEditorFields:x,onSelectionChanged:y,deselectAll:E,openDeletePopup:P,deleteSelected:F,openMassEditor:D,addMassEditorFieldsRow:M,changeTableSettings:m,calculateSummaryItems:I}=ye(),A=b(null);return(De,e)=>(j(),_(Q,null,[t("main",Ee,[d(ee,null,{default:c(()=>[d($,{class:"btn-filled"},{default:c(()=>[...e[13]||(e[13]=[u("Сессии",-1)])]),_:1}),d($,null,{default:c(()=>[...e[14]||(e[14]=[u("Оплаты",-1)])]),_:1})]),_:1}),t("div",Me,[s(w)?K("",!0):(j(),J(te,{key:0},we({right:c(()=>[d($,{class:"small-btn",onClick:e[5]||(e[5]=o=>s(L)(s(h)))},{default:c(()=>[...e[20]||(e[20]=[t("img",{src:pe},null,-1)])]),_:1}),d($,{class:"small-btn"},{default:c(()=>[...e[21]||(e[21]=[t("img",{src:fe},null,-1)])]),_:1})]),_:2},[s(f)==!0?{name:"left",fn:c(()=>[t("div",{class:"selected-count controller-item",onClick:e[0]||(e[0]=(...o)=>s(E)&&s(E)(...o))},[t("span",null,"Выбрано: "+W(s(g)),1),d($,{class:"btn-filled"},{default:c(()=>[...e[15]||(e[15]=[t("img",{src:re},null,-1)])]),_:1})]),t("div",{class:"delete-row controller-item",onClick:e[1]||(e[1]=(...o)=>s(P)&&s(P)(...o))},[...e[16]||(e[16]=[t("img",{src:q},null,-1),u(" Удалить ",-1)])]),t("div",{class:"edit controller-item",onClick:e[2]||(e[2]=(...o)=>s(D)&&s(D)(...o))},[...e[17]||(e[17]=[t("img",{src:de},null,-1),u(" Редактировать ",-1)])]),d(ue,{class:"change-status controller-item","dropdown-list":s(V),onChange:e[3]||(e[3]=o=>console.log("Status changed to: ",o))},{default:c(()=>[...e[18]||(e[18]=[t("img",{src:me},null,-1),u(" Изменить статус ",-1)])]),_:1},8,["dropdown-list"]),t("div",{class:"summary controller-item",onClick:e[4]||(e[4]=(...o)=>s(I)&&s(I)(...o))},[...e[19]||(e[19]=[t("img",{src:ce},null,-1),u(" Сумма ",-1)])])]),key:"0"}:void 0]),1024)),s(w)?(j(),J(se,{key:1,"selected-text":`${s(g)} объектов`,items:s(C),onReset:e[6]||(e[6]=o=>(w.value=!1,s(E)()))},null,8,["selected-text","items"])):K("",!0),d(le,{style:{"margin-top":"20px"},columns:s(a),data:s(i),onRowDblclick:e[7]||(e[7]=o=>s(L)(A.value)),onSelectionChanged:s(y),ref_key:"mainTableRef",ref:p},null,8,["columns","data","onSelectionChanged"])])]),d(ne,{"inner-width":"515","custom-class":"session-details",ref_key:"sessionDetailsRef",ref:A},{header:c(()=>[e[23]||(e[23]=t("h2",{class:"title"},"Сессия №1665423547316996",-1)),t("button",{class:"close-btn",onClick:e[8]||(e[8]=o=>s(O)(A.value))},[...e[22]||(e[22]=[t("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M10.668 10.6667L21.3346 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M21.332 10.6667L10.6654 21.3334",stroke:"black","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),body:c(()=>[...e[24]||(e[24]=[t("div",{class:"top-box"},[t("div",{class:"img",style:{"background-image":"url('/src/assets/img/service.png')"}}),t("div",{class:"content"},[t("p",null,[u("Номер ТС: "),t("b",null,"М969ММ777")]),t("p",null,[u("Объект: "),t("b",null,"ТЦ “Мега”"),t("img",{src:X})]),t("p",null,[u("Клиент: "),t("b",null,"ООО Ирбис"),t("img",{src:X})]),t("p",null,[u("Статус: "),t("b",null,"Оплачена")]),t("p",null,[u("Продолжительность: "),t("b",null,"02:44:26")])])],-1),t("div",{class:"box"},[t("h4",null,"Въезд:"),t("div",{class:"d-flex justify-content-between w-100"},[t("p",null,"Дата и время"),t("p",null,[t("b",null,"14.05.24, 20:30:11")])])],-1),t("div",{class:"box"},[t("h4",null,"Оплата:"),t("div",{class:"d-flex justify-content-between w-100"},[t("p",null,"04.11.2025, 15:50:31, Банковская карта ****1234"),t("div",{class:"d-flex"},[t("b",null,"450 ₽")])])],-1)])]),_:1},512),d(oe,{ref_key:"deleteSelectedPopupRef",ref:S,"confirm-style":"red","confirm-text":"Удалить","cancel-text":"Отменить",onConfirm:s(F),onCancel:e[9]||(e[9]=o=>s(O)(s(S)))},{default:c(()=>[t("h2",je,[e[25]||(e[25]=u(" Удалить сессии? ",-1)),e[26]||(e[26]=t("br",null,null,-1)),u(" "+W(s(v)),1)])]),_:1},8,["onConfirm"]),d(ae,{tabs:s(R),"custom-class":"mass-editor-modal","header-title":"Выбрано: 3",onSaveClick:e[11]||(e[11]=o=>console.log("Changes saved!")),ref_key:"massEditorRef",ref:N},{edit:c(()=>[t("form",$e,[e[29]||(e[29]=t("h3",null,"Редактирование выбранных объектов",-1)),e[30]||(e[30]=t("div",{class:"d-flex"},[t("span",{class:"fields-label"},"Параметр"),t("span",{class:"fields-label"},"До изменения"),t("span",{class:"fields-label"},"После изменения")],-1)),(j(!0),_(Q,null,Ce(s(x),(o,B)=>(j(),_("div",{class:"fields-row",key:B},[d(H,{options:s(k)},null,8,["options"]),d(H,{options:s(k)},null,8,["options"]),d(H,{options:s(k)},null,8,["options"]),t("button",{type:"button",class:"delete-row",onClick:Te=>s(x).splice(B,1)},[...e[27]||(e[27]=[t("img",{src:q},null,-1)])],8,he)]))),128)),t("button",{type:"button",class:"add-fields-btn",onClick:e[10]||(e[10]=(...o)=>s(M)&&s(M)(...o))},[...e[28]||(e[28]=[t("img",{src:be},null,-1),u(" Добавить изменения ",-1)])])])]),_:1},8,["tabs"]),d(ie,{"table-columns":s(n),onChange:e[12]||(e[12]=o=>s(m)(o,s(l),s(p))),ref_key:"tableSettingsRef",ref:h},null,8,["table-columns"])],64))}},Ae=ge(Pe,[["__scopeId","data-v-2ac333c2"]]);export{Ae as default};
